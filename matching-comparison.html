<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë§¤ì¹­ ë¹„êµ ì‹œìŠ¤í…œ | CHARM_INYEON</title>
    <style>
      /* 4060ì„¸ëŒ€ íŠ¹í™” ìŠ¤íƒ€ì¼ë§ */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', 'Malgun Gothic', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-size: 18px; /* 4060ì„¸ëŒ€ ê°€ë…ì„± í–¥ìƒ */
        line-height: 1.6;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* í—¤ë” ì˜ì—­ */
      .header {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .header h1 {
        color: #667eea;
        font-size: 32px;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .header p {
        color: #666;
        font-size: 20px;
        margin-bottom: 20px;
      }

      /* ë¹„êµ ëª¨ë“œ ì„ íƒ */
      .comparison-mode {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .mode-btn {
        padding: 15px 30px;
        border: 3px solid #667eea;
        border-radius: 50px;
        background: white;
        color: #667eea;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 150px;
      }

      .mode-btn:hover,
      .mode-btn.active {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      }

      /* ë§¤ì¹­ ì„ íƒ ì˜ì—­ */
      .match-selection {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .match-selection h2 {
        color: #667eea;
        font-size: 26px;
        margin-bottom: 20px;
        text-align: center;
      }

      .match-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .match-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border: 3px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }

      .match-card:hover {
        border-color: #667eea;
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
      }

      .match-card.selected {
        border-color: #667eea;
        background: #f8f9ff;
      }

      .match-card .select-indicator {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #667eea;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 16px;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .match-card.selected .select-indicator {
        opacity: 1;
      }

      .match-profile {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }

      .match-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        font-weight: bold;
      }

      .match-info h3 {
        color: #333;
        font-size: 20px;
        margin-bottom: 5px;
      }

      .match-info p {
        color: #666;
        font-size: 16px;
        margin-bottom: 3px;
      }

      .compatibility-score {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
      }

      .score-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: conic-gradient(#667eea 0deg, #764ba2 180deg, #e0e0e0 360deg);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        font-weight: bold;
        position: relative;
      }

      .score-circle::after {
        content: '';
        position: absolute;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: white;
        z-index: 1;
      }

      .score-text {
        position: relative;
        z-index: 2;
        color: #667eea;
        font-weight: bold;
      }

      .score-label {
        color: #333;
        font-size: 16px;
        font-weight: 600;
      }

      /* ë¹„êµ ë²„íŠ¼ */
      .compare-button {
        display: flex;
        justify-content: center;
        margin-top: 30px;
      }

      .compare-btn {
        padding: 20px 50px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
      }

      .compare-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .compare-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* ë¹„êµ ê²°ê³¼ ì˜ì—­ */
      .comparison-results {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        display: none;
      }

      .comparison-results.active {
        display: block;
      }

      .comparison-results h2 {
        color: #667eea;
        font-size: 28px;
        margin-bottom: 30px;
        text-align: center;
      }

      /* í˜¸í™˜ì„± ë ˆì´ë” ì°¨íŠ¸ */
      .radar-chart-container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .radar-chart-container h3 {
        color: #333;
        font-size: 22px;
        margin-bottom: 20px;
        text-align: center;
      }

      .radar-chart {
        width: 100%;
        height: 400px;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #f8f9ff;
        border-radius: 10px;
        font-size: 18px;
        color: #667eea;
        font-weight: 600;
      }

      /* ìƒì„¸ ë¹„êµ í…Œì´ë¸” */
      .detailed-comparison {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .detailed-comparison h3 {
        color: #333;
        font-size: 22px;
        margin-bottom: 20px;
        text-align: center;
      }

      .comparison-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }

      .comparison-table th,
      .comparison-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
        font-size: 16px;
      }

      .comparison-table th {
        background: #f8f9ff;
        color: #667eea;
        font-weight: 600;
        font-size: 18px;
      }

      .comparison-table tr:hover {
        background: #f8f9ff;
      }

      .score-bar {
        width: 100px;
        height: 20px;
        background: #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
      }

      .score-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 10px;
        transition: width 0.5s ease;
      }

      /* AI ì¶”ì²œ ê°€ì´ë“œ */
      .ai-recommendations {
        background: white;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .ai-recommendations h3 {
        color: #333;
        font-size: 22px;
        margin-bottom: 20px;
        text-align: center;
      }

      .recommendation-card {
        background: #f8f9ff;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 5px solid #667eea;
      }

      .recommendation-card h4 {
        color: #667eea;
        font-size: 18px;
        margin-bottom: 10px;
      }

      .recommendation-card p {
        color: #666;
        font-size: 16px;
        line-height: 1.6;
      }

      /* ëª¨ë°”ì¼ ìµœì í™” */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 26px;
        }

        .header p {
          font-size: 18px;
        }

        .comparison-mode {
          flex-direction: column;
          align-items: center;
        }

        .mode-btn {
          width: 100%;
          max-width: 300px;
        }

        .match-grid {
          grid-template-columns: 1fr;
        }

        .match-profile {
          flex-direction: column;
          text-align: center;
        }

        .comparison-table {
          font-size: 14px;
        }

        .comparison-table th,
        .comparison-table td {
          padding: 10px;
        }

        .compare-btn {
          width: 100%;
          max-width: 300px;
        }
      }

      /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 50px;
        font-size: 18px;
        color: #667eea;
      }

      .spinner {
        width: 30px;
        height: 30px;
        border: 3px solid #e0e0e0;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* ì„±ê³µ ë©”ì‹œì§€ */
      .success-message {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        text-align: center;
        font-size: 16px;
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        text-align: center;
        font-size: 16px;
      }

      /* AI ì¶”ì²œ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
      .ai-recommendations-container {
        display: flex;
        flex-direction: column;
        gap: 25px;
      }

      .primary-recommendation {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .primary-recommendation h4 {
        margin-bottom: 15px;
        font-size: 22px;
      }

      .best-match-card {
        display: flex;
        align-items: center;
        gap: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 15px;
      }

      .match-avatar-small {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        font-weight: bold;
      }

      .match-summary h5 {
        margin-bottom: 5px;
        font-size: 20px;
      }

      .compatibility-score {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 8px;
      }

      .recommendation-reason {
        font-size: 16px;
        opacity: 0.9;
        line-height: 1.4;
      }

      .detailed-recommendations {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .recommendation-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #667eea;
      }

      .recommendation-card.high {
        border-left-color: #f5576c;
        background: #fef9f9;
      }

      .recommendation-card.medium {
        border-left-color: #f093fb;
        background: #fefafe;
      }

      .recommendation-card.low {
        border-left-color: #4facfe;
        background: #f8fbff;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .card-header h4 {
        margin: 0;
        font-size: 18px;
        color: #333;
      }

      .priority-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        color: white;
      }

      .priority-badge.high {
        background: #f5576c;
      }

      .priority-badge.medium {
        background: #f093fb;
      }

      .priority-badge.low {
        background: #4facfe;
      }

      .card-content p {
        margin-bottom: 15px;
        color: #666;
        line-height: 1.6;
      }

      .action-items {
        background: #f8f9ff;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
      }

      .action-items h6 {
        margin-bottom: 10px;
        color: #667eea;
        font-size: 14px;
      }

      .action-items ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .action-items li {
        position: relative;
        padding-left: 20px;
        margin-bottom: 5px;
        color: #333;
        font-size: 14px;
      }

      .action-items li:before {
        content: 'âœ“';
        position: absolute;
        left: 0;
        color: #667eea;
        font-weight: bold;
      }

      .age-group-advice {
        background: #f8f9ff;
        border-radius: 15px;
        padding: 25px;
        border: 2px solid #e0e5ff;
      }

      .age-group-advice h4 {
        margin-bottom: 20px;
        color: #667eea;
        font-size: 20px;
      }

      .advice-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .advice-item {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .advice-item h6 {
        margin-bottom: 10px;
        color: #667eea;
        font-size: 16px;
      }

      .advice-item p {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
        margin: 0;
      }

      .action-plan {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .action-plan h4 {
        margin-bottom: 25px;
        color: #333;
        font-size: 20px;
      }

      .timeline {
        position: relative;
        padding-left: 30px;
      }

      .timeline:before {
        content: '';
        position: absolute;
        left: 15px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #667eea;
      }

      .timeline-item {
        position: relative;
        margin-bottom: 30px;
      }

      .timeline-marker {
        position: absolute;
        left: -22px;
        top: 5px;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #667eea;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .timeline-content {
        background: #f8f9ff;
        border-radius: 10px;
        padding: 15px;
        margin-left: 15px;
      }

      .timeline-content h6 {
        margin-bottom: 8px;
        color: #667eea;
        font-size: 16px;
      }

      .timeline-content p {
        margin: 0;
        color: #666;
        font-size: 14px;
        line-height: 1.5;
      }

      /* ëª¨ë°”ì¼ ìµœì í™” - AI ì¶”ì²œ */
      @media (max-width: 768px) {
        .ai-recommendations-container {
          gap: 20px;
        }

        .primary-recommendation {
          padding: 20px;
        }

        .best-match-card {
          flex-direction: column;
          text-align: center;
        }

        .advice-grid {
          grid-template-columns: 1fr;
        }

        .timeline {
          padding-left: 25px;
        }

        .timeline-marker {
          left: -20px;
          width: 25px;
          height: 25px;
          font-size: 12px;
        }

        .timeline-content {
          margin-left: 10px;
        }
      }

      /* ì¥ë‹¨ì  ë¶„ì„ ìŠ¤íƒ€ì¼ */
      .pros-cons-analysis {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .pros-cons-analysis h3 {
        color: #333;
        font-size: 22px;
        margin-bottom: 20px;
        text-align: center;
      }

      .pros-cons-container {
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .comparative-summary {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .comparative-summary h4 {
        color: #333;
        font-size: 20px;
        margin-bottom: 20px;
      }

      .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .summary-card {
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .summary-card.best {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .summary-card.concern {
        background: linear-gradient(135deg, #f093fb, #f5576c);
        color: white;
      }

      .summary-card.balanced {
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        color: white;
      }

      .summary-card h5 {
        margin-bottom: 10px;
        font-size: 18px;
      }

      .summary-card p {
        margin-bottom: 15px;
        font-size: 16px;
        line-height: 1.4;
      }

      .match-name {
        display: inline-block;
        background: rgba(255, 255, 255, 0.2);
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
      }

      .individual-analysis {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .individual-analysis h4 {
        color: #333;
        font-size: 20px;
        margin-bottom: 20px;
      }

      .analysis-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 20px;
      }

      .match-analysis-card {
        background: #f8f9ff;
        border-radius: 12px;
        padding: 20px;
        border: 2px solid #e0e5ff;
        transition: transform 0.2s ease;
      }

      .match-analysis-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .match-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e0e5ff;
      }

      .match-avatar-tiny {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 18px;
        font-weight: bold;
      }

      .match-title h5 {
        margin-bottom: 5px;
        color: #333;
        font-size: 18px;
      }

      .compatibility-badge {
        background: #667eea;
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .pros-cons-content {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .pros-section,
      .cons-section {
        background: white;
        border-radius: 8px;
        padding: 15px;
      }

      .pros-section h6 {
        color: #28a745;
        margin-bottom: 10px;
        font-size: 16px;
      }

      .cons-section h6 {
        color: #dc3545;
        margin-bottom: 10px;
        font-size: 16px;
      }

      .pros-list,
      .cons-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .pros-list li,
      .cons-list li {
        position: relative;
        padding-left: 20px;
        margin-bottom: 8px;
        font-size: 14px;
        line-height: 1.4;
      }

      .pros-list li:before {
        content: 'âœ“';
        position: absolute;
        left: 0;
        color: #28a745;
        font-weight: bold;
      }

      .cons-list li:before {
        content: 'âœ—';
        position: absolute;
        left: 0;
        color: #dc3545;
        font-weight: bold;
      }

      .reality-check {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
      }

      .reality-check h6 {
        color: #856404;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .reality-check p {
        color: #856404;
        font-size: 14px;
        line-height: 1.4;
        margin: 0;
      }

      .success-factors {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 15px;
      }

      .success-factors h6 {
        color: #155724;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .factors-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .factor-tag {
        background: #28a745;
        color: white;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
      }

      .reality-advice {
        background: #f8f9ff;
        border: 2px solid #e0e5ff;
        border-radius: 15px;
        padding: 25px;
      }

      .reality-advice h4 {
        color: #667eea;
        font-size: 20px;
        margin-bottom: 20px;
      }

      .advice-sections {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .advice-section {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .advice-section h5 {
        color: #667eea;
        font-size: 16px;
        margin-bottom: 15px;
      }

      .advice-section ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .advice-section li {
        position: relative;
        padding-left: 20px;
        margin-bottom: 10px;
        font-size: 14px;
        line-height: 1.4;
        color: #333;
      }

      .advice-section li:before {
        content: 'â€¢';
        position: absolute;
        left: 0;
        color: #667eea;
        font-weight: bold;
      }

      .final-conclusion {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-radius: 15px;
        padding: 25px;
        text-align: center;
      }

      .final-conclusion h4 {
        margin-bottom: 20px;
        font-size: 22px;
      }

      .conclusion-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .conclusion-text {
        font-size: 16px;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .next-steps {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        text-align: left;
      }

      .next-steps h5 {
        margin-bottom: 15px;
        font-size: 18px;
      }

      .next-steps ol {
        margin: 0;
        padding-left: 20px;
      }

      .next-steps li {
        margin-bottom: 10px;
        font-size: 15px;
        line-height: 1.5;
      }

      /* ëª¨ë°”ì¼ ìµœì í™” - ì¥ë‹¨ì  ë¶„ì„ */
      @media (max-width: 768px) {
        .pros-cons-analysis {
          padding: 20px;
        }

        .summary-cards {
          grid-template-columns: 1fr;
        }

        .analysis-grid {
          grid-template-columns: 1fr;
        }

        .match-analysis-card {
          padding: 15px;
        }

        .match-header {
          flex-direction: column;
          text-align: center;
        }

        .advice-sections {
          grid-template-columns: 1fr;
        }

        .final-conclusion {
          padding: 20px;
        }

        .conclusion-content {
          text-align: left;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- í—¤ë” -->
      <div class="header">
        <h1>ğŸ’• ë§¤ì¹­ ë¹„êµ ì‹œìŠ¤í…œ</h1>
        <p>ì—¬ëŸ¬ ë§¤ì¹­ ê²°ê³¼ë¥¼ í•œëˆˆì— ë¹„êµí•˜ê³  ì‹ ì¤‘í•˜ê²Œ ì„ íƒí•˜ì„¸ìš”</p>

        <!-- ë¹„êµ ëª¨ë“œ ì„ íƒ -->
        <div class="comparison-mode">
          <button class="mode-btn active" onclick="setComparisonMode('multiple')">
            ğŸ”„ ë‹¤ì¤‘ ë¹„êµ
          </button>
          <button class="mode-btn" onclick="setComparisonMode('detailed')">ğŸ“Š ìƒì„¸ ë¶„ì„</button>
          <button class="mode-btn" onclick="setComparisonMode('visual')">ğŸ“ˆ ì‹œê°í™”</button>
        </div>
      </div>

      <!-- ë§¤ì¹­ ì„ íƒ ì˜ì—­ -->
      <div class="match-selection">
        <h2>ğŸ¯ ë¹„êµí•  ë§¤ì¹­ì„ ì„ íƒí•˜ì„¸ìš”</h2>

        <!-- ë§¤ì¹­ ëª©ë¡ -->
        <div class="match-grid" id="matchGrid">
          <div class="loading">
            <div class="spinner"></div>
            ë§¤ì¹­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
          </div>
        </div>

        <!-- ë¹„êµ ë²„íŠ¼ -->
        <div class="compare-button">
          <button class="compare-btn" id="compareBtn" onclick="compareMatches()" disabled>
            ğŸ” ì„ íƒí•œ ë§¤ì¹­ ë¹„êµí•˜ê¸°
          </button>
        </div>
      </div>

      <!-- ë¹„êµ ê²°ê³¼ ì˜ì—­ -->
      <div class="comparison-results" id="comparisonResults">
        <h2>ğŸ“Š ë§¤ì¹­ ë¹„êµ ê²°ê³¼</h2>

        <!-- í˜¸í™˜ì„± ë ˆì´ë” ì°¨íŠ¸ -->
        <div class="radar-chart-container">
          <h3>ğŸ¯ í˜¸í™˜ì„± ë ˆì´ë” ì°¨íŠ¸</h3>
          <div class="radar-chart" id="radarChart">ë ˆì´ë” ì°¨íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>

        <!-- ìƒì„¸ ë¹„êµ í…Œì´ë¸” -->
        <div class="detailed-comparison">
          <h3>ğŸ“‹ ìƒì„¸ ë¹„êµ ë¶„ì„</h3>
          <div id="comparisonTableContainer">
            <table class="comparison-table" id="comparisonTable">
              <thead>
                <tr>
                  <th>í•­ëª©</th>
                  <th>ë§¤ì¹­ 1</th>
                  <th>ë§¤ì¹­ 2</th>
                  <th>ì°¨ì´</th>
                </tr>
              </thead>
              <tbody id="comparisonTableBody">
                <!-- ë¹„êµ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œ -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- AI ì¶”ì²œ ê°€ì´ë“œ -->
        <div class="ai-recommendations">
          <h3>ğŸ¤– AI ì¶”ì²œ ê°€ì´ë“œ</h3>
          <div id="aiRecommendations">
            <!-- AI ì¶”ì²œ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œ -->
          </div>
        </div>

        <!-- ì¥ë‹¨ì  ë¶„ì„ -->
        <div class="pros-cons-analysis">
          <h3>âš–ï¸ ì†”ì§í•œ ì¥ë‹¨ì  ë¶„ì„</h3>
          <div id="prosConsAnalysis">
            <!-- ì¥ë‹¨ì  ë¶„ì„ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œ -->
          </div>
        </div>
      </div>
    </div>

    <script>
      // ì „ì—­ ë³€ìˆ˜
      let selectedMatches = [];
      let allMatches = [];
      let currentMode = 'multiple';

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener('DOMContentLoaded', function () {
        loadMatches();
      });

      // ë¹„êµ ëª¨ë“œ ì„¤ì •
      function setComparisonMode(mode) {
        currentMode = mode;

        // ëª¨ë“  ëª¨ë“œ ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll('.mode-btn').forEach(btn => {
          btn.classList.remove('active');
        });

        // ì„ íƒëœ ëª¨ë“œ ë²„íŠ¼ í™œì„±í™”
        event.target.classList.add('active');

        // ì„ íƒëœ ë§¤ì¹­ ì´ˆê¸°í™”
        selectedMatches = [];
        updateCompareButton();
        hideComparisonResults();
      }

      // ë§¤ì¹­ ëª©ë¡ ë¡œë“œ
      async function loadMatches() {
        try {
          const response = await fetch('/api/matching/my-matches', {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('token')}`,
            },
          });

          if (!response.ok) {
            throw new Error('ë§¤ì¹­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          }

          const data = await response.json();
          allMatches = data.data.matches;

          displayMatches(allMatches);
        } catch (error) {
          console.error('ë§¤ì¹­ ë¡œë“œ ì˜¤ë¥˜:', error);
          showError('ë§¤ì¹­ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      }

      // ë§¤ì¹­ ëª©ë¡ í‘œì‹œ
      function displayMatches(matches) {
        const matchGrid = document.getElementById('matchGrid');

        if (matches.length === 0) {
          matchGrid.innerHTML = `
                    <div class="error-message">
                        ì•„ì§ ë§¤ì¹­ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë§¤ì¹­ì„ ìƒì„±í•´ë³´ì„¸ìš”!
                    </div>
                `;
          return;
        }

        matchGrid.innerHTML = matches
          .map(
            match => `
                <div class="match-card" onclick="selectMatch('${match.id}')">
                    <div class="select-indicator">âœ“</div>
                    <div class="match-profile">
                        <div class="match-avatar">
                            ${match.user.name.charAt(0)}
                        </div>
                        <div class="match-info">
                            <h3>${match.user.name}</h3>
                            <p>${match.user.age || 'ë‚˜ì´ ë¹„ê³µê°œ'}</p>
                            <p>${match.user.location?.city || 'ì§€ì—­ ë¹„ê³µê°œ'}</p>
                            <p>ë§¤ì¹­ì¼: ${new Date(match.matchedAt).toLocaleDateString()}</p>
                        </div>
                    </div>
                    <div class="compatibility-score">
                        <div class="score-circle">
                            <div class="score-text">${match.compatibilityScore}%</div>
                        </div>
                        <div class="score-label">í˜¸í™˜ì„± ì ìˆ˜</div>
                    </div>
                </div>
            `
          )
          .join('');
      }

      // ë§¤ì¹­ ì„ íƒ/í•´ì œ
      function selectMatch(matchId) {
        const matchCard = document.querySelector(`[onclick="selectMatch('${matchId}')"]`);

        if (selectedMatches.includes(matchId)) {
          // ì„ íƒ í•´ì œ
          selectedMatches = selectedMatches.filter(id => id !== matchId);
          matchCard.classList.remove('selected');
        } else {
          // ëª¨ë“œì— ë”°ë¥¸ ì„ íƒ ì œí•œ
          if (currentMode === 'multiple' && selectedMatches.length >= 3) {
            showError('ìµœëŒ€ 3ê°œì˜ ë§¤ì¹­ë§Œ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
            return;
          } else if (currentMode === 'detailed' && selectedMatches.length >= 2) {
            showError('ìƒì„¸ ë¶„ì„ ëª¨ë“œì—ì„œëŠ” ìµœëŒ€ 2ê°œì˜ ë§¤ì¹­ë§Œ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤');
            return;
          }

          // ì„ íƒ ì¶”ê°€
          selectedMatches.push(matchId);
          matchCard.classList.add('selected');
        }

        updateCompareButton();
      }

      // ë¹„êµ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      function updateCompareButton() {
        const compareBtn = document.getElementById('compareBtn');
        const minRequired = currentMode === 'visual' ? 1 : 2;

        if (selectedMatches.length >= minRequired) {
          compareBtn.disabled = false;
          compareBtn.textContent = `ğŸ” ì„ íƒí•œ ${selectedMatches.length}ê°œ ë§¤ì¹­ ë¹„êµí•˜ê¸°`;
        } else {
          compareBtn.disabled = true;
          compareBtn.textContent = `ğŸ” ${minRequired}ê°œ ì´ìƒì˜ ë§¤ì¹­ì„ ì„ íƒí•˜ì„¸ìš”`;
        }
      }

      // ë§¤ì¹­ ë¹„êµ ì‹¤í–‰
      async function compareMatches() {
        if (selectedMatches.length < 2) {
          showError('ë¹„êµí•  ë§¤ì¹­ì„ 2ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”');
          return;
        }

        try {
          showLoading();

          // ì„ íƒëœ ë§¤ì¹­ë“¤ì˜ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const matchDetails = await Promise.all(
            selectedMatches.map(matchId => fetchMatchDetails(matchId))
          );

          // ë¹„êµ ê²°ê³¼ ìƒì„±
          generateComparisonResults(matchDetails);

          // ê²°ê³¼ í‘œì‹œ
          showComparisonResults();

          showSuccess('ë§¤ì¹­ ë¹„êµê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (error) {
          console.error('ë§¤ì¹­ ë¹„êµ ì˜¤ë¥˜:', error);
          showError('ë§¤ì¹­ ë¹„êµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
      }

      // ë§¤ì¹­ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      async function fetchMatchDetails(matchId) {
        const response = await fetch(`/api/matching/matches/${matchId}`, {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('token')}`,
          },
        });

        if (!response.ok) {
          throw new Error(`ë§¤ì¹­ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${matchId}`);
        }

        const data = await response.json();
        return data.data.match;
      }

      // ë¹„êµ ê²°ê³¼ ìƒì„±
      function generateComparisonResults(matchDetails) {
        // ìƒì„¸ ë¹„êµ í…Œì´ë¸” ìƒì„±
        generateComparisonTable(matchDetails);

        // ë ˆì´ë” ì°¨íŠ¸ ìƒì„±
        generateRadarChart(matchDetails);

        // AI ì¶”ì²œ ê°€ì´ë“œ ìƒì„±
        generateAIRecommendations(matchDetails);

        // ì¥ë‹¨ì  ë¶„ì„ ìƒì„±
        generateProsConsAnalysis(matchDetails);
      }

      // ìƒì„¸ ë¹„êµ í…Œì´ë¸” ìƒì„±
      function generateComparisonTable(matchDetails) {
        const tbody = document.getElementById('comparisonTableBody');
        const thead = document.querySelector('.comparison-table thead tr');

        // í…Œì´ë¸” í—¤ë” ì—…ë°ì´íŠ¸
        thead.innerHTML = `
                <th>í•­ëª©</th>
                ${matchDetails.map((match, index) => `<th>${match.user.name}</th>`).join('')}
                <th>ì°¨ì´</th>
            `;

        // ë¹„êµ í•­ëª©ë“¤
        const comparisonItems = [
          {
            label: 'ì „ì²´ í˜¸í™˜ì„±',
            getValue: match => match.compatibilityScore,
            format: value => `${value}%`,
          },
          {
            label: 'ê°€ì¹˜ê´€ ì¼ì¹˜ë„',
            getValue: match => match.compatibilityBreakdown?.valuesAlignment || 0,
            format: value => `${value}%`,
          },
          {
            label: 'ì„±ê²© í˜¸í™˜ì„±',
            getValue: match => match.compatibilityBreakdown?.personalityCompatibility || 0,
            format: value => `${value}%`,
          },
          {
            label: 'ë¼ì´í”„ìŠ¤íƒ€ì¼ ì¼ì¹˜ë„',
            getValue: match => match.compatibilityBreakdown?.lifestyleMatch || 0,
            format: value => `${value}%`,
          },
          {
            label: 'ê´€ì‹¬ì‚¬ ì¤‘ë³µë„',
            getValue: match => match.compatibilityBreakdown?.interestOverlap || 0,
            format: value => `${value}%`,
          },
          {
            label: 'ì†Œí†µ ìŠ¤íƒ€ì¼',
            getValue: match => match.compatibilityBreakdown?.communicationStyle || 0,
            format: value => `${value}%`,
          },
          {
            label: 'ë§¤ì¹­ ì‹ ë¢°ë„',
            getValue: match => match.matchReason?.confidenceLevel || 0,
            format: value => `${value}%`,
          },
          {
            label: 'ì—°ë ¹ëŒ€',
            getValue: match => match.user.age || 'ë¹„ê³µê°œ',
            format: value => value,
          },
          {
            label: 'ì§€ì—­',
            getValue: match => match.user.location?.city || 'ë¹„ê³µê°œ',
            format: value => value,
          },
        ];

        // í…Œì´ë¸” ë°”ë”” ìƒì„±
        tbody.innerHTML = comparisonItems
          .map(item => {
            const values = matchDetails.map(match => item.getValue(match));
            const formattedValues = values.map(val => item.format(val));

            // ìˆ«ì ê°’ë“¤ì˜ ì°¨ì´ ê³„ì‚°
            const numericValues = values.filter(val => typeof val === 'number');
            const difference =
              numericValues.length > 1
                ? Math.max(...numericValues) - Math.min(...numericValues)
                : 0;

            return `
                    <tr>
                        <td><strong>${item.label}</strong></td>
                        ${formattedValues.map(val => `<td>${val}</td>`).join('')}
                        <td>${typeof difference === 'number' ? `${difference}%` : '-'}</td>
                    </tr>
                `;
          })
          .join('');
      }

      // ë ˆì´ë” ì°¨íŠ¸ ìƒì„± (ì‹¤ì œ ìº”ë²„ìŠ¤ ì°¨íŠ¸)
      function generateRadarChart(matchDetails) {
        const radarChart = document.getElementById('radarChart');

        // ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„
        const chartData = matchDetails.map((match, index) => ({
          name: match.user.name,
          scores: {
            ê°€ì¹˜ê´€: match.compatibilityBreakdown?.valuesAlignment || 0,
            ì„±ê²©: match.compatibilityBreakdown?.personalityCompatibility || 0,
            ë¼ì´í”„ìŠ¤íƒ€ì¼: match.compatibilityBreakdown?.lifestyleMatch || 0,
            ê´€ì‹¬ì‚¬: match.compatibilityBreakdown?.interestOverlap || 0,
            ì†Œí†µ: match.compatibilityBreakdown?.communicationStyle || 0,
          },
          color: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe'][index % 5],
        }));

        // ìº”ë²„ìŠ¤ ìƒì„±
        radarChart.innerHTML = `
                <div style="text-align: center; width: 100%;">
                    <h4 style="margin-bottom: 20px;">í˜¸í™˜ì„± ë¹„êµ ë ˆì´ë” ì°¨íŠ¸</h4>
                    <div style="display: flex; justify-content: center; margin-bottom: 20px;">
                        <canvas id="radarCanvas" width="400" height="400" style="border: 1px solid #e0e0e0; border-radius: 10px;"></canvas>
                    </div>
                    <div id="chartLegend" style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                        ${chartData
                          .map(
                            person => `
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="width: 16px; height: 16px; background: ${person.color}; border-radius: 50%;"></div>
                                <span style="font-size: 16px; font-weight: 600;">${person.name}</span>
                            </div>
                        `
                          )
                          .join('')}
                    </div>
                </div>
            `;

        // ìº”ë²„ìŠ¤ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        setTimeout(() => {
          drawRadarChart(chartData);
        }, 100);
      }

      // ì‹¤ì œ ë ˆì´ë” ì°¨íŠ¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜
      function drawRadarChart(chartData) {
        const canvas = document.getElementById('radarCanvas');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 150;

        // ìº”ë²„ìŠ¤ í´ë¦¬ì–´
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ë°°ê²½ ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
        drawRadarGrid(ctx, centerX, centerY, radius);

        // ê° ë§¤ì¹­ ë°ì´í„° ê·¸ë¦¬ê¸°
        chartData.forEach((person, index) => {
          drawRadarData(ctx, person, centerX, centerY, radius, index);
        });
      }

      // ë ˆì´ë” ì°¨íŠ¸ ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
      function drawRadarGrid(ctx, centerX, centerY, radius) {
        const categories = ['ê°€ì¹˜ê´€', 'ì„±ê²©', 'ë¼ì´í”„ìŠ¤íƒ€ì¼', 'ê´€ì‹¬ì‚¬', 'ì†Œí†µ'];
        const numCategories = categories.length;
        const angleStep = (2 * Math.PI) / numCategories;

        // ë™ì‹¬ì› ê·¸ë¦¬ê¸°
        ctx.strokeStyle = '#e0e0e0';
        ctx.lineWidth = 1;

        for (let i = 1; i <= 5; i++) {
          const r = (radius * i) / 5;
          ctx.beginPath();
          ctx.arc(centerX, centerY, r, 0, 2 * Math.PI);
          ctx.stroke();

          // ì ìˆ˜ ë ˆì´ë¸”
          ctx.fillStyle = '#999';
          ctx.font = '12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText((i * 20).toString(), centerX + r, centerY - 5);
        }

        // ì¶• ë¼ì¸ê³¼ ì¹´í…Œê³ ë¦¬ ë ˆì´ë¸” ê·¸ë¦¬ê¸°
        ctx.strokeStyle = '#e0e0e0';
        ctx.lineWidth = 1;

        categories.forEach((category, index) => {
          const angle = -Math.PI / 2 + index * angleStep;
          const x = centerX + radius * Math.cos(angle);
          const y = centerY + radius * Math.sin(angle);

          // ì¶• ë¼ì¸
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.lineTo(x, y);
          ctx.stroke();

          // ì¹´í…Œê³ ë¦¬ ë ˆì´ë¸”
          ctx.fillStyle = '#333';
          ctx.font = 'bold 14px Arial';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';

          const labelX = centerX + (radius + 25) * Math.cos(angle);
          const labelY = centerY + (radius + 25) * Math.sin(angle);

          ctx.fillText(category, labelX, labelY);
        });
      }

      // ë ˆì´ë” ì°¨íŠ¸ ë°ì´í„° ê·¸ë¦¬ê¸°
      function drawRadarData(ctx, person, centerX, centerY, radius, index) {
        const categories = ['ê°€ì¹˜ê´€', 'ì„±ê²©', 'ë¼ì´í”„ìŠ¤íƒ€ì¼', 'ê´€ì‹¬ì‚¬', 'ì†Œí†µ'];
        const numCategories = categories.length;
        const angleStep = (2 * Math.PI) / numCategories;

        // ë°ì´í„° ì ë“¤ ê³„ì‚°
        const points = categories.map((category, i) => {
          const angle = -Math.PI / 2 + i * angleStep;
          const score = person.scores[category] || 0;
          const distance = (radius * score) / 100;

          return {
            x: centerX + distance * Math.cos(angle),
            y: centerY + distance * Math.sin(angle),
            score: score,
          };
        });

        // ì˜ì—­ ì±„ìš°ê¸°
        ctx.fillStyle = person.color + '30'; // 30% íˆ¬ëª…ë„
        ctx.strokeStyle = person.color;
        ctx.lineWidth = 2;

        ctx.beginPath();
        points.forEach((point, i) => {
          if (i === 0) {
            ctx.moveTo(point.x, point.y);
          } else {
            ctx.lineTo(point.x, point.y);
          }
        });
        ctx.closePath();
        ctx.fill();
        ctx.stroke();

        // ë°ì´í„° ì  ê·¸ë¦¬ê¸°
        ctx.fillStyle = person.color;
        points.forEach(point => {
          ctx.beginPath();
          ctx.arc(point.x, point.y, 4, 0, 2 * Math.PI);
          ctx.fill();

          // ì ìˆ˜ í…ìŠ¤íŠ¸
          ctx.fillStyle = '#333';
          ctx.font = '11px Arial';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(point.score.toString(), point.x, point.y - 15);
        });
      }

      // AI ì¶”ì²œ ê°€ì´ë“œ ìƒì„± (4060ì„¸ëŒ€ íŠ¹í™”)
      function generateAIRecommendations(matchDetails) {
        const aiRecommendations = document.getElementById('aiRecommendations');

        // ìµœê³  ì ìˆ˜ ë§¤ì¹­ ì°¾ê¸°
        const bestMatch = matchDetails.reduce((best, current) =>
          current.compatibilityScore > best.compatibilityScore ? current : best
        );

        // ì ìˆ˜ ë¶„í¬ ë¶„ì„
        const scoreDistribution = analyzeScoreDistribution(matchDetails);

        // í˜¸í™˜ì„± ì˜ì—­ë³„ ê°•ì  ë¶„ì„
        const strengthAnalysis = analyzeCompatibilityStrengths(matchDetails);

        // 4060ì„¸ëŒ€ ë§ì¶¤ ì¶”ì²œ ìƒì„±
        const recommendations = generateAgeGroupRecommendations(
          matchDetails,
          bestMatch,
          scoreDistribution,
          strengthAnalysis
        );

        // ì¶”ì²œ ì¹´ë“œ ë Œë”ë§
        aiRecommendations.innerHTML = `
                <div class="ai-recommendations-container">
                    <!-- ì£¼ìš” ì¶”ì²œ -->
                    <div class="primary-recommendation">
                        <h4>ğŸ¯ AI ë¶„ì„ ê²°ê³¼</h4>
                        <div class="recommendation-summary">
                            <div class="best-match-card">
                                <div class="match-avatar-small">
                                    ${bestMatch.user.name.charAt(0)}
                                </div>
                                <div class="match-summary">
                                    <h5>${bestMatch.user.name}ë‹˜</h5>
                                    <p class="compatibility-score">${
                                      bestMatch.compatibilityScore
                                    }% í˜¸í™˜ì„±</p>
                                    <p class="recommendation-reason">${generatePersonalizedReason(
                                      bestMatch
                                    )}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì„¸ë¶€ ì¶”ì²œ -->
                    <div class="detailed-recommendations">
                        ${recommendations
                          .map(
                            rec => `
                            <div class="recommendation-card ${rec.priority}">
                                <div class="card-header">
                                    <h4>${rec.title}</h4>
                                    <span class="priority-badge ${rec.priority}">${
                              rec.priorityLabel
                            }</span>
                                </div>
                                <div class="card-content">
                                    <p>${rec.content}</p>
                                    ${
                                      rec.actionItems
                                        ? `
                                        <div class="action-items">
                                            <h6>ì‹¤í–‰ ê°€ì´ë“œ:</h6>
                                            <ul>
                                                ${rec.actionItems
                                                  .map(item => `<li>${item}</li>`)
                                                  .join('')}
                                            </ul>
                                        </div>
                                    `
                                        : ''
                                    }
                                </div>
                            </div>
                        `
                          )
                          .join('')}
                    </div>

                    <!-- 4060ì„¸ëŒ€ íŠ¹í™” ì¡°ì–¸ -->
                    <div class="age-group-advice">
                        <h4>ğŸŒŸ 4060ì„¸ëŒ€ íŠ¹í™” ì¡°ì–¸</h4>
                        <div class="advice-grid">
                            <div class="advice-item">
                                <h6>â° ì‹œê°„ ê´€ë¦¬</h6>
                                <p>ì„œë‘ë¥´ì§€ ë§ê³  ì¶©ë¶„í•œ ì‹œê°„ì„ ë‘ê³  ì•Œì•„ê°€ì„¸ìš”. 4-6ì£¼ ì •ë„ì˜ ì—¬ìœ ë¥¼ ë‘ê³  ê´€ê³„ë¥¼ ë°œì „ì‹œì¼œë³´ì„¸ìš”.</p>
                            </div>
                            <div class="advice-item">
                                <h6>ğŸ’¬ ì†Œí†µ ë°©ì‹</h6>
                                <p>ì§ì ‘ ë§Œë‚˜ì„œ ëŒ€í™”í•˜ëŠ” ê²ƒì„ ì„ í˜¸í•˜ëŠ” ì—°ë ¹ëŒ€ì…ë‹ˆë‹¤. ë©”ì‹œì§€ë³´ë‹¤ëŠ” ì „í™”ë‚˜ ë§Œë‚¨ì„ í†µí•œ ì†Œí†µì„ ì¶”ì²œí•©ë‹ˆë‹¤.</p>
                            </div>
                            <div class="advice-item">
                                <h6>ğŸ¯ ê´€ê³„ ëª©í‘œ</h6>
                                <p>ì¥ê¸°ì ì´ê³  ì•ˆì •ì ì¸ ê´€ê³„ë¥¼ ì¶”êµ¬í•˜ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤. ì§„ì •ì„± ìˆëŠ” ë§ˆìŒìœ¼ë¡œ ì ‘ê·¼í•˜ì„¸ìš”.</p>
                            </div>
                            <div class="advice-item">
                                <h6>ğŸ¤ ë§Œë‚¨ ì¥ì†Œ</h6>
                                <p>ì¡°ìš©í•˜ê³  ê²©ì‹ ìˆëŠ” ì¥ì†Œë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤. ê³ ê¸‰ ì¹´í˜ë‚˜ ë ˆìŠ¤í† ë‘ì—ì„œì˜ ì ì‹¬ ë˜ëŠ” ì €ë… ì‹ì‚¬ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>

                    <!-- ì‹¤í–‰ ê³„íš -->
                    <div class="action-plan">
                        <h4>ğŸ“‹ ë‹¨ê³„ë³„ ì‹¤í–‰ ê³„íš</h4>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-marker">1</div>
                                <div class="timeline-content">
                                    <h6>1ì£¼ì°¨: ì²« ì—°ë½</h6>
                                    <p>ì •ì¤‘í•˜ê³  ì§„ì •ì„± ìˆëŠ” ë©”ì‹œì§€ë¡œ ì²« ì¸ì‚¬ë¥¼ ë‚˜ëˆ„ì„¸ìš”. ìƒëŒ€ë°©ì˜ í”„ë¡œí•„ì„ ìì„¸íˆ ì½ê³  ê³µí†µì ì„ ì–¸ê¸‰í•´ë³´ì„¸ìš”.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker">2</div>
                                <div class="timeline-content">
                                    <h6>2ì£¼ì°¨: ì „í™” í†µí™”</h6>
                                    <p>ë©”ì‹œì§€ë¡œ ì–´ëŠ ì •ë„ ì¹œí•´ì§€ë©´ ì „í™” í†µí™”ë¥¼ ì œì•ˆí•´ë³´ì„¸ìš”. ëª©ì†Œë¦¬ë¥¼ ë“¤ìœ¼ë©° ë” ê¹Šì€ ì†Œí†µì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker">3</div>
                                <div class="timeline-content">
                                    <h6>3ì£¼ì°¨: ì²« ë§Œë‚¨</h6>
                                    <p>ì ì‹¬ ì‹ì‚¬ë‚˜ ì˜¤í›„ ì¹´í˜ì—ì„œ 2-3ì‹œê°„ ì •ë„ì˜ ì²« ë§Œë‚¨ì„ ê³„íší•˜ì„¸ìš”. í¸ì•ˆí•œ ë¶„ìœ„ê¸°ì—ì„œ ì„œë¡œë¥¼ ì•Œì•„ê°€ì„¸ìš”.</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker">4</div>
                                <div class="timeline-content">
                                    <h6>4ì£¼ì°¨: ê´€ê³„ ë°œì „</h6>
                                    <p>ì²« ë§Œë‚¨ì´ ì¢‹ì•˜ë‹¤ë©´ ë‘ ë²ˆì§¸ ë§Œë‚¨ì„ ê³„íší•˜ì„¸ìš”. ì¢€ ë” ê°œì¸ì ì¸ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ë©° ê´€ê³„ë¥¼ ë°œì „ì‹œì¼œë³´ì„¸ìš”.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
      }

      // ì ìˆ˜ ë¶„í¬ ë¶„ì„
      function analyzeScoreDistribution(matchDetails) {
        const scores = matchDetails.map(m => m.compatibilityScore);
        const avg = scores.reduce((a, b) => a + b, 0) / scores.length;
        const max = Math.max(...scores);
        const min = Math.min(...scores);

        return {
          average: Math.round(avg),
          highest: max,
          lowest: min,
          range: max - min,
          distribution: {
            excellent: scores.filter(s => s >= 80).length,
            good: scores.filter(s => s >= 60 && s < 80).length,
            fair: scores.filter(s => s >= 40 && s < 60).length,
            poor: scores.filter(s => s < 40).length,
          },
        };
      }

      // í˜¸í™˜ì„± ì˜ì—­ë³„ ê°•ì  ë¶„ì„
      function analyzeCompatibilityStrengths(matchDetails) {
        const categories = [
          'valuesAlignment',
          'personalityCompatibility',
          'lifestyleMatch',
          'interestOverlap',
          'communicationStyle',
        ];
        const categoryNames = {
          valuesAlignment: 'ê°€ì¹˜ê´€ ì¼ì¹˜',
          personalityCompatibility: 'ì„±ê²© í˜¸í™˜',
          lifestyleMatch: 'ë¼ì´í”„ìŠ¤íƒ€ì¼ ì¼ì¹˜',
          interestOverlap: 'ê´€ì‹¬ì‚¬ ì¤‘ë³µ',
          communicationStyle: 'ì†Œí†µ ë°©ì‹',
        };

        const strengths = {};

        categories.forEach(category => {
          const scores = matchDetails.map(m => m.compatibilityBreakdown?.[category] || 0);
          const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;

          strengths[category] = {
            name: categoryNames[category],
            average: Math.round(avgScore),
            highest: Math.max(...scores),
            bestMatch: matchDetails.find(
              m => (m.compatibilityBreakdown?.[category] || 0) === Math.max(...scores)
            ),
          };
        });

        return strengths;
      }

      // 4060ì„¸ëŒ€ ë§ì¶¤ ì¶”ì²œ ìƒì„±
      function generateAgeGroupRecommendations(
        matchDetails,
        bestMatch,
        scoreDistribution,
        strengthAnalysis
      ) {
        const recommendations = [];

        // ìµœê³  í˜¸í™˜ì„± ì¶”ì²œ
        if (bestMatch.compatibilityScore >= 80) {
          recommendations.push({
            title: 'ğŸ† ìµœìš°ì„  ì¶”ì²œ',
            content: `${bestMatch.user.name}ë‹˜ê³¼ì˜ í˜¸í™˜ì„±ì´ ${bestMatch.compatibilityScore}%ë¡œ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. 4060ì„¸ëŒ€ì—ê²Œ ì¤‘ìš”í•œ ì•ˆì •ì„±ê³¼ ê°€ì¹˜ê´€ ì¼ì¹˜ë„ê°€ ìš°ìˆ˜í•©ë‹ˆë‹¤.`,
            priority: 'high',
            priorityLabel: 'ë†’ìŒ',
            actionItems: [
              'ì •ì¤‘í•œ ì²« ë©”ì‹œì§€ ë³´ë‚´ê¸°',
              'ê³µí†µ ê´€ì‹¬ì‚¬ ì–¸ê¸‰í•˜ê¸°',
              '1-2ì£¼ í›„ ì „í™” í†µí™” ì œì•ˆ',
            ],
          });
        } else if (bestMatch.compatibilityScore >= 65) {
          recommendations.push({
            title: 'â­ ì¶”ì²œ',
            content: `${bestMatch.user.name}ë‹˜ê³¼ì˜ í˜¸í™˜ì„±ì´ ${bestMatch.compatibilityScore}%ë¡œ ì¢‹ìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•˜ë©´ ì¢‹ì€ ê´€ê³„ë¡œ ë°œì „í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
            priority: 'medium',
            priorityLabel: 'ë³´í†µ',
            actionItems: ['ì²œì²œíˆ ì•Œì•„ê°€ê¸°', 'ì¶©ë¶„í•œ ëŒ€í™” ì‹œê°„ í™•ë³´', 'ì„œë¡œì˜ ê°€ì¹˜ê´€ í™•ì¸'],
          });
        }

        // ì ìˆ˜ ë¶„í¬ì— ë”°ë¥¸ ì¡°ì–¸
        if (scoreDistribution.range > 30) {
          recommendations.push({
            title: 'ğŸ“Š ì„ íƒ ê°€ì´ë“œ',
            content: `ë§¤ì¹­ ì ìˆ˜ê°€ ${scoreDistribution.range}%ì˜ í° ì°¨ì´ë¥¼ ë³´ì…ë‹ˆë‹¤. ì ìˆ˜ê°€ ë†’ì€ ë¶„ë¶€í„° ìš°ì„ ì ìœ¼ë¡œ ì—°ë½í•´ë³´ì„¸ìš”.`,
            priority: 'medium',
            priorityLabel: 'ì¤‘ìš”',
            actionItems: [
              'ì ìˆ˜ ìˆœìœ¼ë¡œ ìš°ì„ ìˆœìœ„ ì •í•˜ê¸°',
              'ë™ì‹œì— ë„ˆë¬´ ë§ì€ ë¶„ê³¼ ì—°ë½í•˜ì§€ ì•Šê¸°',
              '2-3ëª…ì—ê²Œ ì§‘ì¤‘í•˜ê¸°',
            ],
          });
        }

        // ê°•ì  ì˜ì—­ ë¶„ì„
        const topStrength = Object.values(strengthAnalysis).reduce((best, current) =>
          current.average > best.average ? current : best
        );

        if (topStrength.average >= 70) {
          recommendations.push({
            title: 'ğŸ’ª ê°•ì  í™œìš©',
            content: `ì „ì²´ì ìœ¼ë¡œ ${topStrength.name} ì˜ì—­ì—ì„œ ë†’ì€ í˜¸í™˜ì„±ì„ ë³´ì…ë‹ˆë‹¤. ì´ ë¶€ë¶„ì„ ëŒ€í™”ì˜ ì‹œì‘ì ìœ¼ë¡œ í™œìš©í•˜ì„¸ìš”.`,
            priority: 'low',
            priorityLabel: 'ì°¸ê³ ',
            actionItems: [
              `${topStrength.name} ê´€ë ¨ ì´ì•¼ê¸° ë‚˜ëˆ„ê¸°`,
              'ê³µí†µì  ì°¾ì•„ì„œ ëŒ€í™” ì´ì–´ê°€ê¸°',
              'ìì—°ìŠ¤ëŸ¬ìš´ ë§Œë‚¨ ì£¼ì œë¡œ í™œìš©',
            ],
          });
        }

        // 4060ì„¸ëŒ€ íŠ¹í™” ì¡°ì–¸
        recommendations.push({
          title: 'ğŸŒŸ 4060ì„¸ëŒ€ íŠ¹ë³„ ì¡°ì–¸',
          content:
            'ì´ ì—°ë ¹ëŒ€ëŠ” ì§„ì •ì„±ê³¼ ì•ˆì •ì„±ì„ ì¤‘ì‹œí•©ë‹ˆë‹¤. ì„œë‘ë¥´ì§€ ë§ê³  ì¶©ë¶„í•œ ì‹œê°„ì„ ë‘ê³  ì„œë¡œë¥¼ ì•Œì•„ê°€ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.',
          priority: 'high',
          priorityLabel: 'í•„ìˆ˜',
          actionItems: [
            'ì§„ì •ì„± ìˆëŠ” íƒœë„ë¡œ ì ‘ê·¼',
            'ì˜ˆì˜ì™€ ë§¤ë„ˆ ì¤‘ì‹œ',
            'ì¥ê¸°ì  ê´€ì ì—ì„œ ì ‘ê·¼',
            'ìƒëŒ€ë°© ì‹œê°„ ì¡´ì¤‘',
          ],
        });

        return recommendations;
      }

      // ê°œì¸í™”ëœ ì¶”ì²œ ì´ìœ  ìƒì„±
      function generatePersonalizedReason(bestMatch) {
        const score = bestMatch.compatibilityScore;
        const breakdown = bestMatch.compatibilityBreakdown || {};

        // ê°€ì¥ ë†’ì€ ì ìˆ˜ ì˜ì—­ ì°¾ê¸°
        const categories = {
          valuesAlignment: 'ê°€ì¹˜ê´€ì´ ì˜ ë§ê³ ',
          personalityCompatibility: 'ì„±ê²©ì´ ì˜ ë§ê³ ',
          lifestyleMatch: 'ë¼ì´í”„ìŠ¤íƒ€ì¼ì´ í˜¸í™˜ë˜ê³ ',
          interestOverlap: 'ê´€ì‹¬ì‚¬ê°€ ìœ ì‚¬í•˜ê³ ',
          communicationStyle: 'ì†Œí†µ ë°©ì‹ì´ ì˜ ë§ìŠµë‹ˆë‹¤',
        };

        const topCategory = Object.entries(breakdown).reduce(
          (best, [key, value]) => (value > best.value ? { key, value } : best),
          { key: '', value: 0 }
        );

        const reason = categories[topCategory.key] || 'ì „ë°˜ì ìœ¼ë¡œ ì˜ ë§ìŠµë‹ˆë‹¤';

        if (score >= 85) {
          return `ë§¤ìš° ë†’ì€ í˜¸í™˜ì„±ìœ¼ë¡œ ${reason}. ì•ˆì •ì ì¸ ê´€ê³„ ë°œì „ì´ ê¸°ëŒ€ë©ë‹ˆë‹¤.`;
        } else if (score >= 75) {
          return `ì¢‹ì€ í˜¸í™˜ì„±ìœ¼ë¡œ ${reason}. ì„œë¡œë¥¼ ë” ì•Œì•„ê°€ë©´ ì¢‹ì€ ê´€ê³„ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
        } else {
          return `ì ë‹¹í•œ í˜¸í™˜ì„±ìœ¼ë¡œ ${reason}. ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•´ë³´ì„¸ìš”.`;
        }
      }

      // ì¥ë‹¨ì  ë¶„ì„ ìƒì„± (4060ì„¸ëŒ€ íŠ¹í™”)
      function generateProsConsAnalysis(matchDetails) {
        const prosConsAnalysis = document.getElementById('prosConsAnalysis');

        // ê° ë§¤ì¹­ë³„ ì¥ë‹¨ì  ë¶„ì„
        const analysisResults = matchDetails.map(match => analyzeSingleMatch(match));

        // ì¢…í•© ë¹„êµ ë¶„ì„
        const comparativeAnalysis = generateComparativeAnalysis(analysisResults);

        // ì¥ë‹¨ì  ë¶„ì„ ë Œë”ë§
        prosConsAnalysis.innerHTML = `
                <div class="pros-cons-container">
                    <!-- ì¢…í•© ë¶„ì„ -->
                    <div class="comparative-summary">
                        <h4>ğŸ“Š ì¢…í•© ë¹„êµ ë¶„ì„</h4>
                        <div class="summary-cards">
                            <div class="summary-card best">
                                <h5>ğŸ† ìµœê³  ê°•ì </h5>
                                <p>${comparativeAnalysis.bestStrength.description}</p>
                                <span class="match-name">${
                                  comparativeAnalysis.bestStrength.matchName
                                }</span>
                            </div>
                            <div class="summary-card concern">
                                <h5>âš ï¸ ì£¼ì˜ì </h5>
                                <p>${comparativeAnalysis.mainConcern.description}</p>
                                <span class="match-name">${
                                  comparativeAnalysis.mainConcern.matchName
                                }</span>
                            </div>
                            <div class="summary-card balanced">
                                <h5>âš–ï¸ ê· í˜•ì </h5>
                                <p>${comparativeAnalysis.balancedView}</p>
                            </div>
                        </div>
                    </div>

                    <!-- ê°œë³„ ë§¤ì¹­ ë¶„ì„ -->
                    <div class="individual-analysis">
                        <h4>ğŸ” ê°œë³„ ë§¤ì¹­ ë¶„ì„</h4>
                        <div class="analysis-grid">
                            ${analysisResults
                              .map(
                                analysis => `
                                <div class="match-analysis-card">
                                    <div class="match-header">
                                        <div class="match-avatar-tiny">
                                            ${analysis.name.charAt(0)}
                                        </div>
                                        <div class="match-title">
                                            <h5>${analysis.name}</h5>
                                            <span class="compatibility-badge">${
                                              analysis.score
                                            }% í˜¸í™˜</span>
                                        </div>
                                    </div>
                                    
                                    <div class="pros-cons-content">
                                        <div class="pros-section">
                                            <h6>âœ… ì¥ì </h6>
                                            <ul class="pros-list">
                                                ${analysis.pros
                                                  .map(pro => `<li>${pro}</li>`)
                                                  .join('')}
                                            </ul>
                                        </div>
                                        
                                        <div class="cons-section">
                                            <h6>âŒ ë‹¨ì </h6>
                                            <ul class="cons-list">
                                                ${analysis.cons
                                                  .map(con => `<li>${con}</li>`)
                                                  .join('')}
                                            </ul>
                                        </div>
                                        
                                        <div class="reality-check">
                                            <h6>ğŸ’­ í˜„ì‹¤ì  ì¡°ì–¸</h6>
                                            <p>${analysis.realityCheck}</p>
                                        </div>
                                        
                                        <div class="success-factors">
                                            <h6>ğŸ¯ ì„±ê³µ ìš”ì¸</h6>
                                            <div class="factors-tags">
                                                ${analysis.successFactors
                                                  .map(
                                                    factor => `
                                                    <span class="factor-tag">${factor}</span>
                                                `
                                                  )
                                                  .join('')}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `
                              )
                              .join('')}
                        </div>
                    </div>

                    <!-- 4060ì„¸ëŒ€ íŠ¹í™” í˜„ì‹¤ ì¡°ì–¸ -->
                    <div class="reality-advice">
                        <h4>ğŸŒŸ 4060ì„¸ëŒ€ í˜„ì‹¤ ì¡°ì–¸</h4>
                        <div class="advice-sections">
                            <div class="advice-section">
                                <h5>ğŸ’¡ ì„ íƒ ê¸°ì¤€</h5>
                                <ul>
                                    <li>ì ìˆ˜ë³´ë‹¤ ë‚´ ë§ˆìŒì˜ í¸ì•ˆí•¨ì´ ë” ì¤‘ìš”</li>
                                    <li>ì²« í†µí™”ë‚˜ ë§Œë‚¨ì—ì„œì˜ ìì—°ìŠ¤ëŸ¬ì›€ í™•ì¸</li>
                                    <li>ì„œë¡œì˜ ì¸ìƒ ê²½í—˜ì„ ì¡´ì¤‘í•˜ëŠ” íƒœë„</li>
                                    <li>ë¯¸ë˜ì— ëŒ€í•œ ë¹„ìŠ·í•œ ê´€ì ê³¼ ê°€ì¹˜ê´€</li>
                                </ul>
                            </div>
                            
                            <div class="advice-section">
                                <h5>âš ï¸ ì£¼ì˜ì‚¬í•­</h5>
                                <ul>
                                    <li>ì™„ë²½í•œ ì‚¬ëŒì€ ì—†ë‹¤ëŠ” ê²ƒì„ ì¸ì •í•˜ê¸°</li>
                                    <li>ê³¼ê±°ì˜ ì•„í””ì„ ìƒˆë¡œìš´ ê´€ê³„ì— íˆ¬ì˜í•˜ì§€ ì•Šê¸°</li>
                                    <li>ë„ˆë¬´ ì´ìƒì ì¸ ê¸°ëŒ€ëŠ” ê¸ˆë¬¼</li>
                                    <li>ìƒëŒ€ë°©ì˜ ë‹¨ì ë„ í¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ìƒê°í•´ë³´ê¸°</li>
                                </ul>
                            </div>
                            
                            <div class="advice-section">
                                <h5>ğŸš€ ì„±ê³µ ì „ëµ</h5>
                                <ul>
                                    <li>3ê°œì›” ì •ë„ì˜ ì¶©ë¶„í•œ ì‹œê°„ì„ ë‘ê³  ì•Œì•„ê°€ê¸°</li>
                                    <li>ì„œë¡œì˜ ìƒí™œ íŒ¨í„´ê³¼ ê°€ì¹˜ê´€ ì ê²€</li>
                                    <li>ê°€ì¡±, ì¹œêµ¬ë“¤ê³¼ì˜ ê´€ê³„ ì–‘ìƒ í™•ì¸</li>
                                    <li>ê±´ê°• ê´€ë¦¬ì™€ ë¯¸ë˜ ê³„íšì— ëŒ€í•œ ì´ì•¼ê¸°</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ìµœì¢… ê²°ë¡  -->
                    <div class="final-conclusion">
                        <h4>ğŸ¯ ìµœì¢… ê²°ë¡ </h4>
                        <div class="conclusion-content">
                            <p class="conclusion-text">${generateFinalConclusion(
                              analysisResults
                            )}</p>
                            <div class="next-steps">
                                <h5>ë‹¤ìŒ ë‹¨ê³„:</h5>
                                <ol>
                                    <li>ê°€ì¥ ë§ˆìŒì— ë“œëŠ” 1-2ëª…ê³¼ ë¨¼ì € ì—°ë½í•´ë³´ê¸°</li>
                                    <li>ì „í™” í†µí™”ë¡œ ëª©ì†Œë¦¬ì™€ ëŒ€í™” ìŠ¤íƒ€ì¼ í™•ì¸</li>
                                    <li>ì²« ë§Œë‚¨ì—ì„œ ìì—°ìŠ¤ëŸ¬ìš´ ë¶„ìœ„ê¸° í™•ì¸</li>
                                    <li>ì„œë‘ë¥´ì§€ ë§ê³  ì²œì²œíˆ ê´€ê³„ ë°œì „ì‹œí‚¤ê¸°</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            `;
      }

      // ê°œë³„ ë§¤ì¹­ ë¶„ì„
      function analyzeSingleMatch(match) {
        const breakdown = match.compatibilityBreakdown || {};
        const score = match.compatibilityScore;

        const analysis = {
          name: match.user.name,
          score: score,
          pros: [],
          cons: [],
          realityCheck: '',
          successFactors: [],
        };

        // ì¥ì  ë¶„ì„
        if (breakdown.valuesAlignment >= 80) {
          analysis.pros.push('ê°€ì¹˜ê´€ì´ ë§¤ìš° ì˜ ë§ì•„ ê¹Šì€ ëŒ€í™”ê°€ ê°€ëŠ¥');
        } else if (breakdown.valuesAlignment >= 60) {
          analysis.pros.push('ê¸°ë³¸ì ì¸ ê°€ì¹˜ê´€ì´ ë¹„ìŠ·í•´ ì´í•´í•˜ê¸° ì‰¬ì›€');
        }

        if (breakdown.personalityCompatibility >= 80) {
          analysis.pros.push('ì„±ê²©ì´ ì˜ ë§ì•„ í¸ì•ˆí•œ ê´€ê³„ í˜•ì„± ê°€ëŠ¥');
        } else if (breakdown.personalityCompatibility >= 60) {
          analysis.pros.push('ì„±ê²©ì ìœ¼ë¡œ í° ì¶©ëŒ ì—†ì´ ì§€ë‚¼ ìˆ˜ ìˆìŒ');
        }

        if (breakdown.lifestyleMatch >= 80) {
          analysis.pros.push('ìƒí™œ íŒ¨í„´ì´ ë¹„ìŠ·í•´ ì¼ìƒ ê³µìœ ê°€ ì‰¬ì›€');
        } else if (breakdown.lifestyleMatch >= 60) {
          analysis.pros.push('ë¼ì´í”„ìŠ¤íƒ€ì¼ì´ í¬ê²Œ ë‹¤ë¥´ì§€ ì•ŠìŒ');
        }

        if (breakdown.interestOverlap >= 80) {
          analysis.pros.push('ê³µí†µ ê´€ì‹¬ì‚¬ê°€ ë§ì•„ ì¦ê±°ìš´ ì‹œê°„ ë³´ë‚¼ ìˆ˜ ìˆìŒ');
        } else if (breakdown.interestOverlap >= 60) {
          analysis.pros.push('í•¨ê»˜ ì¦ê¸¸ ìˆ˜ ìˆëŠ” í™œë™ì´ ìˆìŒ');
        }

        if (breakdown.communicationStyle >= 80) {
          analysis.pros.push('ì†Œí†µ ë°©ì‹ì´ ì˜ ë§ì•„ ì˜¤í•´ ì ì„ ê²ƒ');
        } else if (breakdown.communicationStyle >= 60) {
          analysis.pros.push('ì˜ì‚¬ì†Œí†µì—ì„œ í° ì–´ë ¤ì›€ ì—†ì„ ê²ƒ');
        }

        // ë‹¨ì  ë¶„ì„
        if (breakdown.valuesAlignment < 50) {
          analysis.cons.push('ê°€ì¹˜ê´€ ì°¨ì´ë¡œ ì¸í•œ ê°ˆë“± ê°€ëŠ¥ì„±');
        }

        if (breakdown.personalityCompatibility < 50) {
          analysis.cons.push('ì„±ê²© ì°¨ì´ë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ê°€ëŠ¥ì„±');
        }

        if (breakdown.lifestyleMatch < 50) {
          analysis.cons.push('ìƒí™œ íŒ¨í„´ ì°¨ì´ë¡œ ì¸í•œ ë¶ˆí¸í•¨');
        }

        if (breakdown.interestOverlap < 50) {
          analysis.cons.push('ê³µí†µ ê´€ì‹¬ì‚¬ ë¶€ì¡±ìœ¼ë¡œ ì‹¬ì‹¬í•  ìˆ˜ ìˆìŒ');
        }

        if (breakdown.communicationStyle < 50) {
          analysis.cons.push('ì†Œí†µ ë°©ì‹ ì°¨ì´ë¡œ ì˜¤í•´ ë°œìƒ ê°€ëŠ¥');
        }

        // ì¥ë‹¨ì ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •
        if (analysis.pros.length === 0) {
          analysis.pros.push('ì „ë°˜ì ìœ¼ë¡œ ë¬´ë‚œí•œ ê´€ê³„ í˜•ì„± ê°€ëŠ¥');
        }

        if (analysis.cons.length === 0) {
          analysis.cons.push('íŠ¹ë³„í•œ ë¬¸ì œì ì€ ë³´ì´ì§€ ì•ŠìŒ');
        }

        // í˜„ì‹¤ì  ì¡°ì–¸
        if (score >= 85) {
          analysis.realityCheck = 'ë§¤ìš° ì¢‹ì€ ìƒëŒ€ì…ë‹ˆë‹¤. ì ê·¹ì ìœ¼ë¡œ ë§Œë‚˜ë³´ì„¸ìš”.';
        } else if (score >= 70) {
          analysis.realityCheck = 'ì¢‹ì€ ê´€ê³„ë¡œ ë°œì „í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì‹œê°„ì„ ë‘ê³  ì•Œì•„ê°€ë³´ì„¸ìš”.';
        } else if (score >= 60) {
          analysis.realityCheck = 'ë‚˜ì˜ì§€ ì•Šì€ ìƒëŒ€ì…ë‹ˆë‹¤. ì‹¤ì œ ë§Œë‚˜ì„œ ëŠë‚Œì„ í™•ì¸í•´ë³´ì„¸ìš”.';
        } else {
          analysis.realityCheck = 'ì‹ ì¤‘í•˜ê²Œ ì ‘ê·¼í•˜ì„¸ìš”. ì„œë¡œë¥¼ ë” ê¹Šì´ ì´í•´í•˜ëŠ” ì‹œê°„ì´ í•„ìš”í•©ë‹ˆë‹¤.';
        }

        // ì„±ê³µ ìš”ì¸
        const topCategory = Object.entries(breakdown).reduce(
          (best, [key, value]) => (value > best.value ? { key, value } : best),
          { key: '', value: 0 }
        );

        const factorMap = {
          valuesAlignment: 'ê°€ì¹˜ê´€ ì¼ì¹˜',
          personalityCompatibility: 'ì„±ê²© ê¶í•©',
          lifestyleMatch: 'ìƒí™œ íŒ¨í„´',
          interestOverlap: 'ê³µí†µ ê´€ì‹¬ì‚¬',
          communicationStyle: 'ì†Œí†µ ë°©ì‹',
        };

        if (topCategory.key && topCategory.value >= 70) {
          analysis.successFactors.push(factorMap[topCategory.key]);
        }

        analysis.successFactors.push('ì‹œê°„ íˆ¬ì', 'ì§„ì •ì„±', 'ì´í•´ì‹¬');

        return analysis;
      }

      // ì¢…í•© ë¹„êµ ë¶„ì„ ìƒì„±
      function generateComparativeAnalysis(analysisResults) {
        const bestScore = Math.max(...analysisResults.map(a => a.score));
        const bestMatch = analysisResults.find(a => a.score === bestScore);

        const worstScore = Math.min(...analysisResults.map(a => a.score));
        const worstMatch = analysisResults.find(a => a.score === worstScore);

        const avgScore = Math.round(
          analysisResults.reduce((sum, a) => sum + a.score, 0) / analysisResults.length
        );

        return {
          bestStrength: {
            matchName: bestMatch.name,
            description: `${bestMatch.score}%ì˜ ë†’ì€ í˜¸í™˜ì„±ìœ¼ë¡œ ê°€ì¥ ì•ˆì •ì ì¸ ê´€ê³„ ì˜ˆìƒ`,
          },
          mainConcern: {
            matchName: worstMatch.name,
            description: `${worstMatch.score}%ì˜ í˜¸í™˜ì„±ìœ¼ë¡œ ë” ì‹ ì¤‘í•œ ì ‘ê·¼ í•„ìš”`,
          },
          balancedView: `ì „ì²´ í‰ê·  ${avgScore}%ì˜ í˜¸í™˜ì„±ìœ¼ë¡œ ë‚˜ì˜ì§€ ì•Šì€ ì„ íƒì§€ë“¤ì…ë‹ˆë‹¤. ì ìˆ˜ì™€ í•¨ê»˜ ê°œì¸ì  ëŠë‚Œë„ ì¤‘ìš”í•˜ê²Œ ê³ ë ¤í•˜ì„¸ìš”.`,
        };
      }

      // ìµœì¢… ê²°ë¡  ìƒì„±
      function generateFinalConclusion(analysisResults) {
        const avgScore = Math.round(
          analysisResults.reduce((sum, a) => sum + a.score, 0) / analysisResults.length
        );

        const highScoreCount = analysisResults.filter(a => a.score >= 75).length;
        const mediumScoreCount = analysisResults.filter(a => a.score >= 60 && a.score < 75).length;

        if (highScoreCount > 0) {
          return `ì „ì²´ì ìœ¼ë¡œ ì¢‹ì€ ë§¤ì¹­ ê²°ê³¼ì…ë‹ˆë‹¤. íŠ¹íˆ ${highScoreCount}ëª…ê³¼ëŠ” ë†’ì€ í˜¸í™˜ì„±ì„ ë³´ì—¬ì£¼ì–´ ì¢‹ì€ ê´€ê³„ë¡œ ë°œì „í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. 4060ì„¸ëŒ€ì˜ íŠ¹ì„±ìƒ ì„œë‘ë¥´ì§€ ë§ê³  ì¶©ë¶„í•œ ì‹œê°„ì„ ë‘ê³  ì„œë¡œë¥¼ ì•Œì•„ê°€ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.`;
        } else if (mediumScoreCount > 0) {
          return `ì ë‹¹í•œ ìˆ˜ì¤€ì˜ ë§¤ì¹­ ê²°ê³¼ì…ë‹ˆë‹¤. ${mediumScoreCount}ëª…ê³¼ëŠ” ë¬´ë‚œí•œ ê´€ê³„ë¥¼ í˜•ì„±í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. ì‹¤ì œ ë§Œë‚¨ì„ í†µí•´ ì ìˆ˜ë¡œ ë“œëŸ¬ë‚˜ì§€ ì•ŠëŠ” ì¼€ë¯¸ìŠ¤íŠ¸ë¦¬ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.`;
        } else {
          return `í˜„ì¬ ë§¤ì¹­ ê²°ê³¼ëŠ” ë‹¤ì†Œ ì•„ì‰½ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í˜¸í™˜ì„± ì ìˆ˜ê°€ ëª¨ë“  ê²ƒì„ ê²°ì •í•˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ì‹œê°„ì„ ë‘ê³  ì„œë¡œë¥¼ ì´í•´í•˜ë©° ê´€ê³„ë¥¼ ë°œì „ì‹œì¼œë³´ì„¸ìš”.`;
        }
      }

      // ë¹„êµ ê²°ê³¼ í‘œì‹œ
      function showComparisonResults() {
        const results = document.getElementById('comparisonResults');
        results.classList.add('active');

        // ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤
        results.scrollIntoView({ behavior: 'smooth' });
      }

      // ë¹„êµ ê²°ê³¼ ìˆ¨ê¸°ê¸°
      function hideComparisonResults() {
        const results = document.getElementById('comparisonResults');
        results.classList.remove('active');
      }

      // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
      function showLoading() {
        const compareBtn = document.getElementById('compareBtn');
        compareBtn.innerHTML = '<div class="spinner"></div>ë¹„êµ ë¶„ì„ ì¤‘...';
        compareBtn.disabled = true;
      }

      function showSuccess(message) {
        const matchSelection = document.querySelector('.match-selection');
        const successMsg = document.createElement('div');
        successMsg.className = 'success-message';
        successMsg.textContent = message;
        matchSelection.insertBefore(successMsg, matchSelection.firstChild);

        setTimeout(() => {
          successMsg.remove();
          updateCompareButton(); // ë²„íŠ¼ ìƒíƒœ ë³µì›
        }, 3000);
      }

      function showError(message) {
        const matchSelection = document.querySelector('.match-selection');
        const errorMsg = document.createElement('div');
        errorMsg.className = 'error-message';
        errorMsg.textContent = message;
        matchSelection.insertBefore(errorMsg, matchSelection.firstChild);

        setTimeout(() => {
          errorMsg.remove();
          updateCompareButton(); // ë²„íŠ¼ ìƒíƒœ ë³µì›
        }, 5000);
      }

      // í† í° í™•ì¸ í•¨ìˆ˜
      function checkAuthToken() {
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return false;
        }
        return true;
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸
      if (!checkAuthToken()) {
        document.body.innerHTML =
          '<div class="container"><div class="error-message">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...</div></div>';
      }
    </script>
  </body>
</html>
