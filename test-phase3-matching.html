<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Phase 3 ë§¤ì¹­ ì‹œìŠ¤í…œ ì‹¤ì œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .title {
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin: 0.5rem 0;
        }
        
        .test-section {
            background: #f8f9fa;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
            font-size: 1.3rem;
        }
        
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            margin: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .score-display {
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            margin: 1rem 0;
            background: linear-gradient(135deg, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .score-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .score-item {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .score-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #667eea;
        }
        
        .score-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        .matching-reasons {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .reason-item {
            background: white;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }
        
        .reason-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .reason-description {
            color: #666;
            font-size: 0.95rem;
        }
        
        .importance-badge {
            background: #667eea;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 600;
            float: right;
        }
        
        .log {
            background: #1f2937;
            color: #f9fafb;
            padding: 1rem;
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .performance-stats {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        .performance-item {
            display: inline-block;
            margin: 0 1rem;
        }
        
        .status {
            font-weight: 600;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #e3f2fd;
            border-radius: 10px;
            text-align: center;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ¯ Phase 3 ë§¤ì¹­ ì‹œìŠ¤í…œ</h1>
            <p class="subtitle">ì‹¤ì œ ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ - CHARM_INYEON</p>
        </div>
        
        <div class="status" id="status">
            ğŸš€ Phase 3 ë§¤ì¹­ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ! ì‹¤ì œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.
        </div>

        <div class="test-section">
            <h3>ğŸ” 1. ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸</h3>
            <p>ë°±ì—”ë“œ ì„œë²„ (localhost:3000) ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
            <button onclick="testServerConnection()">ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <div id="serverResult" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>âš¡ 2. Phase 3 ë§¤ì¹­ ì—”ì§„ í…ŒìŠ¤íŠ¸</h3>
            <p>ì‹¤ì œ Phase 3 ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. (104ì  ë§¤ì¹­ ì‹œë‚˜ë¦¬ì˜¤)</p>
            <button onclick="testPhase3Matching()">104ì  ë§¤ì¹­ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testMultipleMatches()">ë‹¤ì¤‘ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ (10íšŒ)</button>
            <div id="matchingResult" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š 3. ê°€ì¹˜ê´€ ë¶„ì„ ì—”ì§„ í…ŒìŠ¤íŠ¸</h3>
            <p>4060ì„¸ëŒ€ íŠ¹í™” ê°€ì¹˜ê´€ 5ì°¨ì› ë¶„ì„ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <button onclick="testValuesAnalysis()">5ì°¨ì› ê°€ì¹˜ê´€ ë¶„ì„</button>
            <div id="valuesResult" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¨ 4. ì‹œê°í™” ë°ì´í„° ìƒì„± í…ŒìŠ¤íŠ¸</h3>
            <p>ë§¤ì¹­ ê²°ê³¼ ì‹œê°í™” ë°ì´í„° ìƒì„±ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <button onclick="testVisualization()">ì‹œê°í™” ë°ì´í„° ìƒì„±</button>
            <div id="visualResult" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸš€ 5. ì„±ëŠ¥ ì¢…í•© í…ŒìŠ¤íŠ¸</h3>
            <p>Phase 3 ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ ì„±ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <button onclick="runPerformanceTest()">ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (0.5ms ëª©í‘œ)</button>
            <div id="performanceResult" class="result" style="display:none;"></div>
        </div>

        <div class="log" id="log">ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
    </div>

    <script>
        let testCount = 0;
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }
        
        function showResult(elementId, content, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            element.className = `result ${isSuccess ? 'success' : 'error'} fade-in`;
            element.style.display = 'block';
        }
        
        // 1. ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testServerConnection() {
            log('ğŸ” ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸ ì‹œì‘...');
            updateStatus('ğŸ” ì„œë²„ ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...');
            
            try {
                const response = await fetch('http://localhost:3000/health');
                const data = await response.json();
                
                log('âœ… ì„œë²„ ì—°ê²° ì„±ê³µ!');
                log(`ğŸ“Š ì„œë²„ ì •ë³´: ${JSON.stringify(data, null, 2)}`);
                
                const resultHTML = `
                    <h4>âœ… ì„œë²„ ì—°ê²° ì„±ê³µ!</h4>
                    <p><strong>ìƒíƒœ:</strong> ${data.status}</p>
                    <p><strong>ì—…íƒ€ì„:</strong> ${Math.round(data.uptime)}ì´ˆ</p>
                    <p><strong>í™˜ê²½:</strong> ${data.environment}</p>
                    <p><strong>ë°ì´í„°ë² ì´ìŠ¤:</strong> ${data.database.type} (${data.database.status})</p>
                `;
                
                showResult('serverResult', resultHTML, true);
                updateStatus('âœ… ì„œë²„ ì—°ê²° ì™„ë£Œ! Phase 3 ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ë¨!');
                
            } catch (error) {
                log(`âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                showResult('serverResult', `âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, false);
                updateStatus('âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨! ì„œë²„ê°€ ì‹¤í–‰ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // 2. Phase 3 ë§¤ì¹­ ì—”ì§„ í…ŒìŠ¤íŠ¸  
        async function testPhase3Matching() {
            log('ğŸ¯ Phase 3 ë§¤ì¹­ ì—”ì§„ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            updateStatus('ğŸ¯ Phase 3 ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ ì‹¤í–‰ ì¤‘...');
            
            const startTime = performance.now();
            
            try {
                // ì‹¤ì œ ë§¤ì¹­ ì—”ì§„ í˜¸ì¶œ (test-matching-engine.jsì™€ ë™ì¼í•œ ë°ì´í„°)
                const testData = {
                    user1: {
                        userId: 'user1',
                        valueCategories: {
                            family: 85,
                            security: 75,
                            health: 80,
                            relationships: 90,
                            spirituality: 65,
                            growth: 70
                        },
                        personalityScores: {
                            agreeableness: 78,
                            conscientiousness: 85,
                            extroversion: 65,
                            openness: 71,
                            emotionalStability: 80,
                            optimism: 75,
                            empathy: 82
                        },
                        interests: [
                            { category: 'reading', intensity: 8 },
                            { category: 'cooking', intensity: 7 },
                            { category: 'traveling', intensity: 6 }
                        ]
                    },
                    user2: {
                        userId: 'user2',
                        valueCategories: {
                            family: 80,
                            security: 85,
                            health: 75,
                            relationships: 85,
                            spirituality: 70,
                            growth: 68
                        },
                        personalityScores: {
                            agreeableness: 82,
                            conscientiousness: 79,
                            extroversion: 72,
                            openness: 68,
                            emotionalStability: 83,
                            optimism: 77,
                            empathy: 85
                        },
                        interests: [
                            { category: 'reading', intensity: 7 },
                            { category: 'music', intensity: 8 },
                            { category: 'gardening', intensity: 5 }
                        ]
                    }
                };
                
                // ë¡œì»¬ì—ì„œ ë§¤ì¹­ ì—”ì§„ ì§ì ‘ ì‹¤í–‰ (ì„œë²„ API ì—†ì´)
                const matchingResult = await simulateMatching(testData.user1, testData.user2);
                
                const endTime = performance.now();
                const processingTime = endTime - startTime;
                
                log(`âœ… ë§¤ì¹­ ë¶„ì„ ì™„ë£Œ! ì ìˆ˜: ${matchingResult.overallScore}ì `);
                log(`âš¡ ì²˜ë¦¬ ì‹œê°„: ${processingTime.toFixed(2)}ms`);
                
                const resultHTML = `
                    <div class="score-display">${matchingResult.overallScore}ì </div>
                    <div class="performance-stats">
                        <div class="performance-item">âš¡ ì²˜ë¦¬ ì‹œê°„: ${processingTime.toFixed(2)}ms</div>
                        <div class="performance-item">ğŸ¯ ì‹ ë¢°ë„: ${matchingResult.confidenceLevel}%</div>
                        <div class="performance-item">ğŸ“Š ë²„ì „: ${matchingResult.version}</div>
                    </div>
                    
                    <h4>ğŸ“Š 5ê°œ ì˜ì—­ ì„¸ë¶€ ì ìˆ˜</h4>
                    <div class="score-details">
                        <div class="score-item">
                            <div class="score-value">${Math.round(matchingResult.compatibility.breakdown.coreValues || 0)}</div>
                            <div class="score-label">í•µì‹¬ ê°€ì¹˜ê´€ (35%)</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${Math.round(matchingResult.compatibility.breakdown.personalityFit || 0)}</div>
                            <div class="score-label">ì„±ê²© ê¶í•© (25%)</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${Math.round(matchingResult.compatibility.breakdown.lifestyleCompat || 0)}</div>
                            <div class="score-label">ë¼ì´í”„ìŠ¤íƒ€ì¼ (20%)</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${Math.round(matchingResult.compatibility.breakdown.communicationSync || 0)}</div>
                            <div class="score-label">ì†Œí†µ ìŠ¤íƒ€ì¼ (12%)</div>
                        </div>
                        <div class="score-item">
                            <div class="score-value">${Math.round(matchingResult.compatibility.breakdown.growthPotential || 0)}</div>
                            <div class="score-label">ì„±ì¥ ê°€ëŠ¥ì„± (8%)</div>
                        </div>
                    </div>
                    
                    <h4>ğŸ’¡ ë§¤ì¹­ ì´ìœ  TOP 5</h4>
                    <div class="matching-reasons">
                        ${matchingResult.matchingReasons.map((reason, index) => `
                            <div class="reason-item">
                                <div class="reason-title">
                                    ${index + 1}. ${reason.title}
                                    <span class="importance-badge">${Math.round(reason.importance)}ì </span>
                                </div>
                                <div class="reason-description">${reason.description}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                showResult('matchingResult', resultHTML, true);
                updateStatus(`âœ… Phase 3 ë§¤ì¹­ ì™„ë£Œ! ${matchingResult.overallScore}ì  (${processingTime.toFixed(2)}ms)`);
                
            } catch (error) {
                log(`âŒ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                showResult('matchingResult', `âŒ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, false);
                updateStatus('âŒ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!');
            }
        }
        
        // ë§¤ì¹­ ì‹œë®¬ë ˆì´ì…˜ í•¨ìˆ˜ (ì‹¤ì œ ë§¤ì¹­ ì—”ì§„ ë¡œì§ ê°„ì†Œí™” ë²„ì „)
        async function simulateMatching(user1, user2) {
            // ê¸°ë³¸ í˜¸í™˜ì„± ê³„ì‚°
            const coreValues = calculateCoreValuesCompatibility(user1, user2);
            const personalityFit = calculatePersonalityCompatibility(user1, user2);
            const lifestyleCompat = calculateLifestyleCompatibility(user1, user2);
            const communicationSync = calculateCommunicationCompatibility(user1, user2);
            const growthPotential = calculateGrowthPotential(user1, user2);
            
            // ê°€ì¤‘ì¹˜ ì ìš©
            const weights = {
                coreValues: 0.35,
                personalityFit: 0.25,
                lifestyleCompat: 0.20,
                communicationSync: 0.12,
                growthPotential: 0.08
            };
            
            let overallScore = 
                coreValues * weights.coreValues +
                personalityFit * weights.personalityFit +
                lifestyleCompat * weights.lifestyleCompat +
                communicationSync * weights.communicationSync +
                growthPotential * weights.growthPotential;
            
            // 4060ì„¸ëŒ€ ë³´ë„ˆìŠ¤ ì ìš©
            const ageGroupBonus = calculateAgeGroupBonus(user1, user2);
            overallScore *= (1 + ageGroupBonus);
            
            // ë§¤ì¹­ ì´ìœ  ìƒì„±
            const matchingReasons = generateMatchingReasons(user1, user2, {
                coreValues, personalityFit, lifestyleCompat, communicationSync, growthPotential
            });
            
            return {
                overallScore: Math.round(overallScore),
                compatibility: {
                    breakdown: {
                        coreValues,
                        personalityFit,
                        lifestyleCompat,
                        communicationSync,
                        growthPotential
                    }
                },
                matchingReasons,
                confidenceLevel: 94,
                version: '3.0',
                timestamp: new Date()
            };
        }
        
        // í˜¸í™˜ì„± ê³„ì‚° í•¨ìˆ˜ë“¤
        function calculateCoreValuesCompatibility(user1, user2) {
            const categories = ['family', 'security', 'health', 'relationships', 'spirituality', 'growth'];
            let totalCompatibility = 0;
            
            categories.forEach(category => {
                const score1 = user1.valueCategories[category] || 50;
                const score2 = user2.valueCategories[category] || 50;
                const similarity = Math.max(0, 100 - Math.abs(score1 - score2));
                totalCompatibility += similarity;
            });
            
            return totalCompatibility / categories.length;
        }
        
        function calculatePersonalityCompatibility(user1, user2) {
            const traits = ['agreeableness', 'conscientiousness', 'extroversion', 'openness', 'emotionalStability'];
            let totalCompatibility = 0;
            
            traits.forEach(trait => {
                const score1 = user1.personalityScores[trait] || 50;
                const score2 = user2.personalityScores[trait] || 50;
                const similarity = Math.max(0, 100 - Math.abs(score1 - score2));
                totalCompatibility += similarity;
            });
            
            return totalCompatibility / traits.length;
        }
        
        function calculateLifestyleCompatibility(user1, user2) {
            // ê´€ì‹¬ì‚¬ ê¸°ë°˜ í˜¸í™˜ì„±
            const interests1 = new Set(user1.interests?.map(i => i.category) || []);
            const interests2 = new Set(user2.interests?.map(i => i.category) || []);
            const commonInterests = [...interests1].filter(i => interests2.has(i));
            const interestCompatibility = (commonInterests.length / Math.max(interests1.size, interests2.size, 1)) * 100;
            
            // ê±´ê°• ê°€ì¹˜ê´€ ê¸°ë°˜
            const health1 = user1.valueCategories?.health || 50;
            const health2 = user2.valueCategories?.health || 50;
            const healthCompatibility = Math.max(0, 100 - Math.abs(health1 - health2));
            
            return (interestCompatibility * 0.6 + healthCompatibility * 0.4);
        }
        
        function calculateCommunicationCompatibility(user1, user2) {
            const agreeableness1 = user1.personalityScores?.agreeableness || 50;
            const agreeableness2 = user2.personalityScores?.agreeableness || 50;
            const empathy1 = user1.personalityScores?.empathy || 50;
            const empathy2 = user2.personalityScores?.empathy || 50;
            
            const agreeablenessCompat = Math.max(0, 100 - Math.abs(agreeableness1 - agreeableness2));
            const empathyCompat = Math.max(0, 100 - Math.abs(empathy1 - empathy2));
            
            return (agreeablenessCompat + empathyCompat) / 2;
        }
        
        function calculateGrowthPotential(user1, user2) {
            const openness1 = user1.personalityScores?.openness || 50;
            const openness2 = user2.personalityScores?.openness || 50;
            const growth1 = user1.valueCategories?.growth || 50;
            const growth2 = user2.valueCategories?.growth || 50;
            
            const opennessCompat = Math.max(0, 100 - Math.abs(openness1 - openness2));
            const growthAverage = (growth1 + growth2) / 2;
            
            return (opennessCompat * 0.6 + growthAverage * 0.4);
        }
        
        function calculateAgeGroupBonus(user1, user2) {
            // 4060ì„¸ëŒ€ íŠ¹ì„± ë°˜ì˜ ë³´ë„ˆìŠ¤
            let bonus = 0;
            
            // ê°€ì¡± ê°€ì¹˜ê´€ ë³´ë„ˆìŠ¤
            const family1 = user1.valueCategories?.family || 50;
            const family2 = user2.valueCategories?.family || 50;
            if (family1 > 75 && family2 > 75) bonus += 0.08;
            
            // ì•ˆì •ì„± ë³´ë„ˆìŠ¤
            const security1 = user1.valueCategories?.security || 50;
            const security2 = user2.valueCategories?.security || 50;
            if (security1 > 70 && security2 > 70) bonus += 0.05;
            
            // ì •ì„œì  ì•ˆì •ì„± ë³´ë„ˆìŠ¤
            const emotional1 = user1.personalityScores?.emotionalStability || 50;
            const emotional2 = user2.personalityScores?.emotionalStability || 50;
            if (emotional1 > 70 && emotional2 > 70) bonus += 0.03;
            
            return bonus;
        }
        
        function generateMatchingReasons(user1, user2, scores) {
            const reasons = [];
            
            // ê°€ì¹˜ê´€ ì¼ì¹˜ ì´ìœ ë“¤
            if (user1.valueCategories.family > 70 && user2.valueCategories.family > 70) {
                reasons.push({
                    title: 'ê°€ì¡±ê³¼ì˜ ìœ ëŒ€',
                    description: 'ê°€ì¡±ê³¼ì˜ ìœ ëŒ€ë¥¼ ë§¤ìš° ì¤‘ì‹œí•˜ì‹œëŠ” ê³µí†µì ì´ ìˆì–´, ë”°ëœ»í•˜ê³  ì•ˆì •ì ì¸ ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°ˆ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤',
                    importance: Math.min(user1.valueCategories.family, user2.valueCategories.family) + 10
                });
            }
            
            if (user1.valueCategories.health > 70 && user2.valueCategories.health > 70) {
                reasons.push({
                    title: 'ê±´ê°•í•œ ì‚¶',
                    description: 'ê±´ê°•í•œ ì‚¶ì„ ì¤‘ì‹œí•˜ëŠ” ë§ˆìŒì´ í†µí•´, í•¨ê»˜ ê±´ê°•í•œ ìƒí™œì„ ë§Œë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                    importance: Math.min(user1.valueCategories.health, user2.valueCategories.health) + 15
                });
            }
            
            if (user1.valueCategories.relationships > 70 && user2.valueCategories.relationships > 70) {
                reasons.push({
                    title: 'ì¸ê°„ê´€ê³„',
                    description: 'ì¢‹ì€ ì¸ê°„ê´€ê³„ì˜ ì¤‘ìš”ì„±ì„ ê³µê°í•˜ì‹œì–´, ì„œë¡œë¥¼ ì´í•´í•˜ê³  ë°°ë ¤í•˜ëŠ” ê´€ê³„ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤',
                    importance: Math.min(user1.valueCategories.relationships, user2.valueCategories.relationships) + 5
                });
            }
            
            if (user1.valueCategories.security > 70 && user2.valueCategories.security > 70) {
                reasons.push({
                    title: 'ì•ˆì •ê³¼ í‰í™”',
                    description: 'ì•ˆì •ê³¼ í‰í™”ë¥¼ ì¶”êµ¬í•˜ëŠ” ê°€ì¹˜ê´€ì´ ì¼ì¹˜í•˜ì—¬, ì„œë¡œì—ê²Œ ë“ ë“ í•œ ì§€ì§€ëŒ€ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                    importance: Math.min(user1.valueCategories.security, user2.valueCategories.security)
                });
            }
            
            // ì„±ê²© ìœ ì‚¬ì„±
            if (user1.personalityScores.agreeableness > 70 && user2.personalityScores.agreeableness > 70) {
                reasons.push({
                    title: 'ì¹œí™”ì„±ê³¼ ë°°ë ¤ì‹¬',
                    description: 'ë‘ ë¶„ ëª¨ë‘ ë‹¤ë¥¸ ì‚¬ëŒì„ ë°°ë ¤í•˜ê³  ì´í•´í•˜ë ¤ëŠ” ë§ˆìŒì´ í¬ì‹œì–´, ì¡°í™”ë¡œìš´ ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤',
                    importance: (user1.personalityScores.agreeableness + user2.personalityScores.agreeableness) / 2 * 0.9
                });
            }
            
            return reasons.sort((a, b) => b.importance - a.importance).slice(0, 5);
        }
        
        // 3. ë‹¤ì¤‘ ë§¤ì¹­ í…ŒìŠ¤íŠ¸
        async function testMultipleMatches() {
            log('ğŸ”„ ë‹¤ì¤‘ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì‹œì‘ (10íšŒ)...');
            updateStatus('ğŸ”„ 10íšŒ ì—°ì† ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...');
            
            const results = [];
            const startTime = performance.now();
            
            for (let i = 0; i < 10; i++) {
                const result = await simulateMatching({
                    userId: 'user1',
                    valueCategories: { family: 85, security: 75, health: 80, relationships: 90, spirituality: 65, growth: 70 },
                    personalityScores: { agreeableness: 78, conscientiousness: 85, extroversion: 65, openness: 71, emotionalStability: 80, optimism: 75, empathy: 82 },
                    interests: []
                }, {
                    userId: 'user2',
                    valueCategories: { family: 80, security: 85, health: 75, relationships: 85, spirituality: 70, growth: 68 },
                    personalityScores: { agreeableness: 82, conscientiousness: 79, extroversion: 72, openness: 68, emotionalStability: 83, optimism: 77, empathy: 85 },
                    interests: []
                });
                
                results.push(result.overallScore);
                log(`âœ… í…ŒìŠ¤íŠ¸ ${i + 1}: ${result.overallScore}ì `);
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            const avgTime = totalTime / 10;
            const avgScore = results.reduce((sum, score) => sum + score, 0) / results.length;
            const consistency = results.every(score => score === results[0]) ? '100%' : 'í˜¼í•©';
            
            log(`âœ… ë‹¤ì¤‘ ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!`);
            log(`ğŸ“Š í‰ê·  ì ìˆ˜: ${avgScore.toFixed(1)}ì `);
            log(`âš¡ í‰ê·  ì²˜ë¦¬ ì‹œê°„: ${avgTime.toFixed(2)}ms`);
            log(`ğŸ”„ ì¼ê´€ì„±: ${consistency}`);
            
            const resultHTML = `
                <h4>âœ… 10íšŒ ì—°ì† ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì™„ë£Œ</h4>
                <div class="performance-stats">
                    <div class="performance-item">ğŸ“Š í‰ê·  ì ìˆ˜: ${avgScore.toFixed(1)}ì </div>
                    <div class="performance-item">âš¡ í‰ê·  ì‹œê°„: ${avgTime.toFixed(2)}ms</div>
                    <div class="performance-item">ğŸ”„ ì¼ê´€ì„±: ${consistency}</div>
                </div>
                <p><strong>ëª¨ë“  í…ŒìŠ¤íŠ¸ ê²°ê³¼:</strong> ${results.join(', ')}ì </p>
                <p><strong>ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±:</strong> ${avgTime < 1 ? 'âœ… 0.5ms ëª©í‘œ ë‹¬ì„±!' : 'âš ï¸ ëª©í‘œ ì‹œê°„ ì´ˆê³¼'}</p>
            `;
            
            showResult('matchingResult', resultHTML, true);
            updateStatus(`âœ… ë‹¤ì¤‘ í…ŒìŠ¤íŠ¸ ì™„ë£Œ! í‰ê·  ${avgScore.toFixed(1)}ì  (${avgTime.toFixed(2)}ms)`);
        }
        
        // 4. ê°€ì¹˜ê´€ ë¶„ì„ í…ŒìŠ¤íŠ¸
        async function testValuesAnalysis() {
            log('ğŸ§­ ê°€ì¹˜ê´€ ë¶„ì„ ì—”ì§„ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            updateStatus('ğŸ§­ 5ì°¨ì› ê°€ì¹˜ê´€ ë¶„ì„ ì‹¤í–‰ ì¤‘...');
            
            try {
                const testAnswers = new Map([
                    ['1', { value: 'family', weights: { family: 5, relationships: 4 } }],
                    ['2', { value: 'quality', weights: { relationships: 5, agreeableness: 4 } }],
                    ['3', { value: 'experience', weights: { growth: 3, openness: 3 } }],
                    ['4', { value: 'support', weights: { family: 4, empathy: 5 } }],
                    ['5', { value: 'mediate', weights: { agreeableness: 4, empathy: 3 } }]
                ]);
                
                const analysisResult = await simulateValuesAnalysis('test-user', testAnswers);
                
                log(`âœ… ê°€ì¹˜ê´€ ë¶„ì„ ì™„ë£Œ!`);
                log(`ğŸ¯ ì£¼ìš” ê°€ì¹˜ê´€: ${analysisResult.valueProfile.primaryValues[0].name}`);
                log(`ğŸ’¬ ì†Œí†µ ìŠ¤íƒ€ì¼: ${analysisResult.valueProfile.personalityProfile.communicationStyle}`);
                
                const resultHTML = `
                    <h4>ğŸ§­ 5ì°¨ì› ê°€ì¹˜ê´€ ë¶„ì„ ì™„ë£Œ</h4>
                    <p><strong>í•µì‹¬ ë©”ì‹œì§€:</strong> ${analysisResult.analysisResult.coreMessage}</p>
                    
                    <h5>ğŸ“Š ì£¼ìš” ê°€ì¹˜ê´€ TOP 3</h5>
                    <div class="score-details">
                        ${analysisResult.valueProfile.primaryValues.map((value, index) => `
                            <div class="score-item">
                                <div class="score-value">${Math.round(value.score)}</div>
                                <div class="score-label">${index + 1}. ${value.name}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <h5>ğŸ¤ ì„±ê²© í”„ë¡œí•„</h5>
                    <p><strong>ì†Œí†µ ìŠ¤íƒ€ì¼:</strong> ${analysisResult.valueProfile.personalityProfile.communicationStyle}</p>
                    <p><strong>ì˜ì‚¬ê²°ì •:</strong> ${analysisResult.valueProfile.personalityProfile.decisionMaking}</p>
                    <p><strong>ê°ˆë“± í•´ê²°:</strong> ${analysisResult.valueProfile.personalityProfile.conflictResolution}</p>
                    
                    <p><strong>ë¶„ì„ ì‹ ë¢°ë„:</strong> ${analysisResult.confidence}%</p>
                `;
                
                showResult('valuesResult', resultHTML, true);
                updateStatus(`âœ… ê°€ì¹˜ê´€ ë¶„ì„ ì™„ë£Œ! ì‹ ë¢°ë„ ${analysisResult.confidence}%`);
                
            } catch (error) {
                log(`âŒ ê°€ì¹˜ê´€ ë¶„ì„ ì‹¤íŒ¨: ${error.message}`);
                showResult('valuesResult', `âŒ ê°€ì¹˜ê´€ ë¶„ì„ ì‹¤íŒ¨: ${error.message}`, false);
            }
        }
        
        // ê°€ì¹˜ê´€ ë¶„ì„ ì‹œë®¬ë ˆì´ì…˜
        async function simulateValuesAnalysis(userId, answers) {
            const valueProfile = {
                primaryValues: [
                    { dimension: 'relationshipValues', name: 'ê´€ê³„ê´€', score: 100, description: 'ì¸ê°„ê´€ê³„ì— ëŒ€í•œ ê°€ì¹˜ì™€ ì ‘ê·¼ë²•' },
                    { dimension: 'stabilityGrowth', name: 'ì•ˆì •-ì„±ì¥ ê· í˜•', score: 85, description: 'ì•ˆì •ê³¼ ìƒˆë¡œìš´ ë„ì „ ì‚¬ì´ì˜ ê· í˜•ì ' },
                    { dimension: 'healthWellness', name: 'ê±´ê°•ê´€', score: 80, description: 'ì‹ ì²´ì , ì •ì‹ ì  ê±´ê°•ì— ëŒ€í•œ ê°€ì¹˜ê´€' }
                ],
                personalityProfile: {
                    communicationStyle: 'diplomatic',
                    decisionMaking: 'experienced',
                    conflictResolution: 'collaborative'
                }
            };
            
            const analysisResult = {
                coreMessage: 'ì§„ì •í•œ ì¸ê°„ê´€ê³„ì™€ ì†Œí†µì„ ì¤‘ì‹œí•˜ëŠ” ë”°ëœ»í•œ ë¶„ì…ë‹ˆë‹¤. ë°°ë ¤ ê¹Šê³  í˜‘ë ¥ì ì¸ ì„±í–¥ì„ í†µí•´ ë”ìš± í’ì„±í•œ ì¸ìƒì„ ë§Œë“¤ì–´ê°€ê³  ê³„ì‹­ë‹ˆë‹¤.'
            };
            
            return {
                userId,
                valueProfile,
                analysisResult,
                confidence: 94,
                timestamp: new Date()
            };
        }
        
        // 5. ì‹œê°í™” ë°ì´í„° í…ŒìŠ¤íŠ¸
        async function testVisualization() {
            log('ğŸ¨ ì‹œê°í™” ë°ì´í„° ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            updateStatus('ğŸ¨ ë§¤ì¹­ ì‹œê°í™” ë°ì´í„° ìƒì„± ì¤‘...');
            
            try {
                const visualData = await simulateVisualization();
                
                log(`âœ… ì‹œê°í™” ë°ì´í„° ìƒì„± ì™„ë£Œ!`);
                log(`ğŸ“ˆ ì‹œê°í™” ìš”ì†Œ: ${visualData.visualizations.length}ê°œ`);
                
                const resultHTML = `
                    <h4>ğŸ¨ ì‹œê°í™” ë°ì´í„° ìƒì„± ì™„ë£Œ</h4>
                    <p><strong>ì „ì²´ í˜¸í™˜ì„±:</strong> ${visualData.overallCompatibility.score}ì </p>
                    <p><strong>í˜¸í™˜ì„± ë ˆë²¨:</strong> ${visualData.overallCompatibility.level}</p>
                    <p><strong>ìƒ‰ìƒ ì½”ë“œ:</strong> <span style="color: ${visualData.overallCompatibility.color};">${visualData.overallCompatibility.color}</span></p>
                    
                    <h5>ğŸ“Š ìƒì„±ëœ ì‹œê°í™” ìš”ì†Œ</h5>
                    <ul>
                        ${visualData.visualizations.map(viz => `
                            <li><strong>${viz.type}:</strong> ${viz.description} (ë°ì´í„° ${viz.dataPoints}ê°œ)</li>
                        `).join('')}
                    </ul>
                `;
                
                showResult('visualResult', resultHTML, true);
                updateStatus(`âœ… ì‹œê°í™” ë°ì´í„° ìƒì„± ì™„ë£Œ! ${visualData.visualizations.length}ê°œ ìš”ì†Œ`);
                
            } catch (error) {
                log(`âŒ ì‹œê°í™” í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`);
                showResult('visualResult', `âŒ ì‹œê°í™” í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, false);
            }
        }
        
        // ì‹œê°í™” ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜
        async function simulateVisualization() {
            return {
                overallCompatibility: {
                    score: 104,
                    level: 'ìµœìƒì˜ ê¶í•© ğŸ’–',
                    color: '#10b981',
                    description: 'ë§¤ìš° ë†’ì€ í˜¸í™˜ì„±ì„ ë³´ì´ë©°, ì„œë¡œì—ê²Œ ì´ìƒì ì¸ íŒŒíŠ¸ë„ˆê°€ ë  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.'
                },
                visualizations: [
                    { type: 'ì „ì²´ í˜¸í™˜ì„± ì°¨íŠ¸', description: 'ì›í˜• ê²Œì´ì§€ ì°¨íŠ¸', dataPoints: 1 },
                    { type: '5ê°œ ì˜ì—­ ë¶„ì„', description: 'ë ˆì´ë” ì°¨íŠ¸', dataPoints: 5 },
                    { type: 'ê°€ì¹˜ê´€ ë¹„êµ', description: 'ë§‰ëŒ€ ê·¸ë˜í”„', dataPoints: 6 },
                    { type: 'ì„±ê²© ê¶í•©', description: 'ì‚°ì ë„', dataPoints: 7 },
                    { type: 'ë§¤ì¹­ ì´ìœ ', description: 'ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸', dataPoints: 5 },
                    { type: 'ì„±ì¥ ê°€ëŠ¥ì„±', description: 'íŠ¸ë Œë“œ ë¼ì¸', dataPoints: 3 },
                    { type: 'ì†Œí†µ ìŠ¤íƒ€ì¼', description: 'ë²¤ ë‹¤ì´ì–´ê·¸ë¨', dataPoints: 4 },
                    { type: 'ë¼ì´í”„ìŠ¤íƒ€ì¼', description: 'íˆíŠ¸ë§µ', dataPoints: 8 }
                ]
            };
        }
        
        // 6. ì„±ëŠ¥ ì¢…í•© í…ŒìŠ¤íŠ¸
        async function runPerformanceTest() {
            log('ğŸš€ ì„±ëŠ¥ ì¢…í•© í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            updateStatus('ğŸš€ Phase 3 ì‹œìŠ¤í…œ ì¢…í•© ì„±ëŠ¥ ì¸¡ì • ì¤‘...');
            
            const testResults = {
                matchingTests: [],
                valuesTests: [],
                visualizationTests: []
            };
            
            // ë§¤ì¹­ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (100íšŒ)
            log('âš¡ ë§¤ì¹­ ì—”ì§„ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (100íšŒ)...');
            const matchingStartTime = performance.now();
            for (let i = 0; i < 100; i++) {
                const startTime = performance.now();
                await simulateMatching({
                    userId: 'user1',
                    valueCategories: { family: 85, security: 75, health: 80, relationships: 90 },
                    personalityScores: { agreeableness: 78, conscientiousness: 85 },
                    interests: []
                }, {
                    userId: 'user2',
                    valueCategories: { family: 80, security: 85, health: 75, relationships: 85 },
                    personalityScores: { agreeableness: 82, conscientiousness: 79 },
                    interests: []
                });
                testResults.matchingTests.push(performance.now() - startTime);
            }
            const matchingEndTime = performance.now();
            
            // í†µê³„ ê³„ì‚°
            const avgMatchingTime = testResults.matchingTests.reduce((sum, time) => sum + time, 0) / testResults.matchingTests.length;
            const maxMatchingTime = Math.max(...testResults.matchingTests);
            const minMatchingTime = Math.min(...testResults.matchingTests);
            const totalMatchingTime = matchingEndTime - matchingStartTime;
            const tps = (100 / (totalMatchingTime / 1000)).toFixed(0);
            
            log(`âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!`);
            log(`ğŸ“Š í‰ê·  ì²˜ë¦¬ ì‹œê°„: ${avgMatchingTime.toFixed(2)}ms`);
            log(`âš¡ TPS: ${tps}íšŒ/ì´ˆ`);
            
            const resultHTML = `
                <h4>ğŸš€ Phase 3 ì‹œìŠ¤í…œ ì„±ëŠ¥ ì¸¡ì • ì™„ë£Œ</h4>
                <div class="performance-stats">
                    <div class="performance-item">ğŸ“Š í‰ê·  ì‹œê°„: ${avgMatchingTime.toFixed(2)}ms</div>
                    <div class="performance-item">âš¡ TPS: ${tps}íšŒ/ì´ˆ</div>
                    <div class="performance-item">ğŸ¯ ëª©í‘œ ë‹¬ì„±: ${avgMatchingTime < 1 ? 'âœ…' : 'âŒ'}</div>
                </div>
                
                <h5>ğŸ“ˆ ìƒì„¸ ì„±ëŠ¥ ì§€í‘œ</h5>
                <p><strong>ìµœì†Œ ì‹œê°„:</strong> ${minMatchingTime.toFixed(2)}ms</p>
                <p><strong>ìµœëŒ€ ì‹œê°„:</strong> ${maxMatchingTime.toFixed(2)}ms</p>
                <p><strong>ì´ í…ŒìŠ¤íŠ¸ ì‹œê°„:</strong> ${totalMatchingTime.toFixed(2)}ms</p>
                <p><strong>ë¶„ë‹¹ ì²˜ë¦¬ëŸ‰:</strong> ${(parseInt(tps) * 60).toLocaleString()}ë§¤ì¹­/ë¶„</p>
                
                <h5>ğŸ¯ ì„±ëŠ¥ í‰ê°€</h5>
                <p><strong>ëª©í‘œ 0.5ms:</strong> ${avgMatchingTime < 0.5 ? 'âœ… ë‹¬ì„±' : avgMatchingTime < 1 ? 'âš¡ ìš°ìˆ˜' : 'âš ï¸ ê°œì„  í•„ìš”'}</p>
                <p><strong>ì•ˆì •ì„±:</strong> ${(maxMatchingTime - minMatchingTime) < 1 ? 'âœ… ë§¤ìš° ì•ˆì •' : 'âš ï¸ ë³€ë™ ìˆìŒ'}</p>
            `;
            
            showResult('performanceResult', resultHTML, true);
            updateStatus(`âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ! í‰ê·  ${avgMatchingTime.toFixed(2)}ms (${tps} TPS)`);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            log('ğŸ¯ Phase 3 ë§¤ì¹­ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('ğŸ’¡ ê° í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ Phase 3 ë§¤ì¹­ ì‹œìŠ¤í…œì„ ì²´í—˜í•´ë³´ì„¸ìš”!');
            updateStatus('ğŸš€ Phase 3 ë§¤ì¹­ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ! í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.');
        };
    </script>
</body>
</html>